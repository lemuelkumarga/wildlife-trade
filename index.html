<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Lemuel Kumarga" />


<title>Identifying Major Players in Endangered Wildlife Trade</title>

<script src="index_files/jquery-1.12.4/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="index_files/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="index_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="index_files/navigation-1.1/tabsets.js"></script>
<script src="index_files/navigation-1.1/codefolding.js"></script>
<link href="index_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="index_files/highlightjs-9.12.0/highlight.js"></script>
<script src="index_files/htmlwidgets-1.2/htmlwidgets.js"></script>
<script src="index_files/viz-0.3/viz.js"></script>
<link href="index_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="index_files/grViz-binding-1.0.0/grViz.js"></script>
<script src="index_files/d3-3.5.3/d3.min.js"></script>
<link href="index_files/colorbrewer-1/colorbrewer.css" rel="stylesheet" />
<script src="index_files/colorbrewer-1/colorbrewer.js"></script>
<link href="index_files/streamgraph-1/streamgraph.css" rel="stylesheet" />
<script src="index_files/streamgraph-binding-0.8.1/streamgraph.js"></script>
<link href="index_files/sequences-0.1/sequences.css" rel="stylesheet" />
<script src="index_files/sunburst-binding-2.0.0/sunburst.js"></script>
<link href="index_files/leaflet-0.7.7/leaflet.css" rel="stylesheet" />
<script src="index_files/leaflet-0.7.7/leaflet.js"></script>
<link href="index_files/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<link href="index_files/leaflet-label-0.2.2/leaflet.label.css" rel="stylesheet" />
<script src="index_files/leaflet-label-0.2.2/leaflet.label.js"></script>
<script src="index_files/Proj4Leaflet-0.7.2/proj4-compressed.js"></script>
<script src="index_files/Proj4Leaflet-0.7.2/proj4leaflet.js"></script>
<script src="index_files/leaflet-binding-1.1.0/leaflet.js"></script>
<script src="index_files/leaflet-providers-1.0.27/leaflet-providers.js"></script>
<script src="index_files/leaflet-providers-plugin-1.1.0/leaflet-providers-plugin.js"></script>
<link href="index_files/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.css" rel="stylesheet" />
<script src="index_files/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.min.js"></script>
<link href="index_files/fontawesome-4.7.0/font-awesome.min.css" rel="stylesheet" />
<script src="shared/js/popover.js"></script>
<script src="shared/js/html-widgets.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="shared/css/defaults.css" />
<link rel="stylesheet" href="shared/css/defaults.css" />
<link rel="stylesheet" href="../../shared/css/definitions.css" />
<link rel="stylesheet" href="shared/css/defaults.css" />
<link rel="stylesheet" href="shared/css/defaults.css" />
<link rel="stylesheet" href="../../shared/css/definitions.css" />
<link rel="stylesheet" href="../../shared/css/general.css" />
<link rel="stylesheet" href="shared/css/Rmd.css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>






<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Identifying Major Players in Endangered Wildlife Trade</h1>
<h4 class="author"><em><span class="meta">Lemuel Kumarga</span></em></h4>
<h4 class="date"><em><span class="meta">May 2018</span></em></h4>

</div>


<style>
/* Add custom css for this particular portfolio */
.players-container {
  display: flex; 
  flex-wrap: wrap; 
  justify-content: space-around
}

a.players {
    margin: 1em;
}

a.players img {
    width: 100px;
    min-width: 100px;
    height: 100px;
    min-height: 100px;
    opacity: 1.0;
    filter: saturate(0%);
    -webkit-filter: saturate(0%);
}

a.players:hover img {
    opacity: 1.0;
    filter: saturate(80%);
    -webkit-filter: saturate(80%);
}

.players-container .popover {
    max-width: 250px;
}
</style>


<section id="modeling-wildlife-trade" class="level3">
<h3>Modeling Wildlife Trade</h3>
<p>To run the PageRank algorithm, we need to model the wildlife trade as a network, with the countries represented as <span class="hl">vertices</span>. Two countries are connected by an <span class="hl">edge</span> if the two trade with one another. The degree of wildlife trading between two countries defines the <span>weight</span> of the edge. For the purposes of this study, we will use the sum of imports and exports as the edges’ weights.</p>
<p>Using the above definitions, we are now equipped to model the wildlife trade for the period of 2001 to 2015:</p>
<pre class="r"><code>max_label_char &lt;- 20
vertices &lt;- unique(c(dataset$Importer,dataset$Exporter)) %&gt;%
            sort() %&gt;%
            { data.frame(index=.)} %&gt;%
            inner_join(world_borders@data, by=c(&quot;index&quot;=&quot;ISO2&quot;)) %&gt;%
            # Create labels that truncate names
            mutate(NAME_SHORT = ifelse(nchar(NAME) &gt;= max_label_char, sprintf(&quot;%s...&quot;,substr(NAME,1,max_label_char - 3)), NAME),
                   REGION = paste0(&quot;REGION-&quot;,REGION),
                   SUBREGION = paste0(&quot;SUBREGION-&quot;,SUBREGION)) %&gt;%
            arrange(REGION, SUBREGION)

edges &lt;- dataset %&gt;%
         filter(Importer %in% vertices$index &amp; 
                  Exporter %in% vertices$index &amp;
                  Importer != Exporter) %&gt;%
         mutate(v1 = ifelse(Importer &lt; Exporter, Importer, Exporter),
                v2 = ifelse(Importer &lt; Exporter, Exporter, Importer)) %&gt;%
         group_by(v1,v2) %&gt;%
         summarise(total_trades = sum(Qty))

# Calculate imports + exports of each country
vertices$VALUE &lt;- sapply(vertices$index, function(i) { sum(edges[edges$v1 == i | edges$v2 == i,]$total_trades) })

# Filter Top X Countries If Necessary
input_vertices &lt;- vertices
input_edges &lt;- edges %&gt;% filter(v1 %in% input_vertices$index &amp; v2 %in% input_vertices$index)

# Huge thanks to R Graph Gallery for Template
# https://www.r-graph-gallery.com/hierarchical-edge-bundling/

# Create Inputs For The Model
# Color palette for edges and input_vertices
color_dictionary &lt;- get_color(&quot;palette&quot;)(length(unique(input_vertices$REGION)))
names(color_dictionary) &lt;- unique(input_vertices$REGION)
n_points &lt;- 100

# Graph Creation
hierarchy &lt;- rbind(input_vertices %&gt;% mutate(parent=&quot;root&quot;) %&gt;% select(parent,child=REGION) %&gt;% unique(),
                   input_vertices %&gt;% select(parent=REGION,child=SUBREGION) %&gt;% unique(),
                   input_vertices %&gt;% select(parent=SUBREGION, child=index))

# Node Specifications
nodes &lt;- data.frame(name = unique(c(as.character(hierarchy$parent), as.character(hierarchy$child)))) %&gt;%
         left_join(input_vertices %&gt;% select(index, label=NAME_SHORT, region=REGION, value=VALUE), by=c(&quot;name&quot;=&quot;index&quot;)) %&gt;%
         mutate(ranking=rank(value,ties.method=&quot;first&quot;))

# Edge Specifications
connections &lt;- data.frame(from=match(input_edges$v1, nodes$name),
                          to=match(input_edges$v2, nodes$name),
                          weights=input_edges$total_trades)

total_trade_min_cutoff &lt;- quantile(input_edges$total_trades, 0.5)
total_trade_max_cutoff &lt;- quantile(input_edges$total_trades, 0.999)
connections$alpha &lt;- lapply(1:nrow(input_edges), 
                        function(i) {
                          a &lt;- max(min((input_edges$total_trades[i] - total_trade_min_cutoff) / (total_trade_max_cutoff - total_trade_min_cutoff),1.),0.)
                          list(rep(a,n_points))})

connections$colors &lt;- lapply(1:nrow(input_edges), 
                        function(i) {
                          v1 &lt;- input_edges[[i,&quot;v1&quot;]]
                          v2 &lt;- input_edges[[i,&quot;v2&quot;]]
                          
                          # Set up colors
                          region_v1 &lt;- (input_vertices %&gt;% filter(index == v1))$REGION
                          region_v2 &lt;- (input_vertices %&gt;% filter(index == v2))$REGION
                          list(colorRampPalette(c(color_dictionary[[region_v1]],color_dictionary[[region_v2]]))(n_points))
                          
                      })

# Plot the Graph
edge_bundle_graph &lt;-graph_from_data_frame(hierarchy, vertices = nodes)
edge_bundle_plot &lt;- ggraph(edge_bundle_graph, layout=&quot;dendrogram&quot;, circular=TRUE) +
                    theme_void() +
                    theme_lk(TRUE, TRUE, FALSE, FALSE)

# Add Edge Bundles
# There is a bug in ggraph_1.0.0.9999 where geom_conn_bundle can only plot at most 2 nodes of from before messing up the coloring,
# we will fix this by generating geom_conn_bundle one node at a time
for (v1 in unique(connections$from)) {
  tmp &lt;- connections %&gt;% filter(from == v1)
  edge_bundle_plot &lt;- edge_bundle_plot +        
                      geom_conn_bundle(data=get_con(from = tmp$from, to = tmp$to), 
                                       colour=unlist(tmp$colors),
                                       alpha=unlist(tmp$alpha),
                                       n = n_points,
                                       tension = 0.8) 
  
} 

# Adjust the angle and horizontal alignment of nodes based on the position of x and y
edge_bundle_plot$data[&quot;angle&quot;] &lt;- sapply(1:nrow(edge_bundle_plot$data), 
                                       function (i) {
                                          t_ratio &lt;- min(max(edge_bundle_plot$data$y[i] / edge_bundle_plot$data$x[i], -10000),10000)
                                          atan(t_ratio) * 180 / pi
                                        })
edge_bundle_plot$data[&quot;hjust&quot;] &lt;- sapply(edge_bundle_plot$data$x, 
                                         function (x) {
                                           ifelse(x &lt; 0, 1, 0)
                                         })
# Add Node Points
edge_bundle_plot &lt;- edge_bundle_plot +
                    # Create Nodes
                    geom_node_point(aes(filter = leaf, x = x, y=y, colour=region, size=value), alpha=0.8) +
                    geom_node_text(aes(filter = leaf, x = x*1.05, y=y*1.05, 
                                       colour=region, label=label, alpha=ranking,
                                       angle=angle, hjust=hjust), size=2.5) +
                    scale_size_continuous(name=&quot;Wildlife Trading Activity (Gross Imports + Exports)&quot;,
                                          label=function (v) { sprintf(&quot;%.0f mil&quot;,v/1000000)},
                                          guide=guide_legend(override.aes = list(color=txt_color, alpha=0.8))) + 
                    scale_color_manual(values=color_dictionary, guide=&quot;none&quot;) +
                    scale_alpha_continuous(limits=c(max(nodes$ranking)-100,max(nodes$ranking)-10), na.value=0.1, guide=&quot;none&quot;) +
                    # Make sure labels are viewable
                    expand_limits(x = c(-1.25, 1.25), y = c(-1.25, 1.25))
  
edge_bundle_plot</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-25-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>The <a href="https://www.r-graph-gallery.com/hierarchical-edge-bundling/" target="_blank">hierarchical edge bundle</a> plot shows the degree of involvement of each country. The larger the circle, the greater the total imports and exports of the country. Unsurprisingly, <span class="hl blue-text">United States</span>, <span class="hl orange-text">China</span> and <span class="hl orange-text">Indonesia</span> have the highest total imports and exports.</p>
<p>Other than that, we can also identify the most popular trade routes. The larger the wildlife trading, the higher the opacity of that edge. The chart above surfaces some overlooked routes, such as <span class="hl blue-text">Ecuador</span> to <span class="hl orange-text">China</span>.</p>
</section>
<!--
<section id="the-pagerank-algorithm" class="level3">
<h3>The PageRank Algorithm</h3>
<p>With the network constructed, we can proceed to run the PageRank algorithm:</p>
<pre class="r"><code>trade_graph &lt;- graph_from_data_frame(edges %&gt;% rename(weight=total_trades), vertices = vertices)
pr_rankings &lt;- page_rank(trade_graph, directed = FALSE)$vector
pr_rankings &lt;- data.frame(index=names(pr_rankings), PRANK=pr_rankings)

# Add rankings to the vertices
vertices &lt;- vertices %&gt;%
            left_join(pr_rankings, by=&quot;index&quot;) %&gt;%
            mutate(R_PRANK = rank(desc(PRANK),ties.method=&quot;first&quot;))

pander(vertices %&gt;% arrange(desc(PRANK)) %&gt;% head(5) %&gt;%
       mutate(Country=NAME, Imports_And_Exports = comma(VALUE), PageRank = percent(PRANK)) %&gt;% 
         select(Country, Imports_And_Exports, PageRank),
       caption=&quot;The Top 5 Major Players According to PageRank&quot;)</code></pre>
<div class="table-responsive"><table style="width:67%;">
<caption>The Top 5 Major Players According to PageRank</caption>
<colgroup>
<col style="width: 22%" />
<col style="width: 30%" />
<col style="width: 13%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Country</th>
<th style="text-align: left;">Imports_And_Exports</th>
<th style="text-align: left;">PageRank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">United States</td>
<td style="text-align: left;">11,161,261</td>
<td style="text-align: left;">16.5%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Indonesia</td>
<td style="text-align: left;">8,334,342</td>
<td style="text-align: left;">11.7%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">China</td>
<td style="text-align: left;">8,639,113</td>
<td style="text-align: left;">7.6%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Japan</td>
<td style="text-align: left;">3,765,463</td>
<td style="text-align: left;">3.9%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mexico</td>
<td style="text-align: left;">2,845,480</td>
<td style="text-align: left;">3.5%</td>
</tr>
</tbody>
</table></div>
<p>Before continuing, it is important for us to understand what the PageRank number represents. When used for assessing the quality of websites, this number refers to a person’s <span class="hl">probability of viewing the website</span>. The higher the PageRank probability, the more likely the person will view the website, and hence the higher the quality of the site.</p>
<p>Similarly, in the widlife trading context, the PageRank of a country A is the <span class="hl">probability that A is responsible for a wildlife trade</span>. The higher the PageRank of a country, the more wildlife trades are attributed to it. In other words, if there are 1 million trades worldwide, <span class="hl">United States</span> would account for approximately <span class="hl">0.165 million</span> trades. By identifying countries with the highest PageRank, we can determine who the major players are.</p>
<section id="comparing-with-imports-exports-approach" class="level4">
<h4>Comparing With Imports + Exports Approach</h4>
<p>To comprehend further, let us first compare PageRank with Imports + Exports:</p>
<pre class="r"><code>pr_inputs &lt;- vertices %&gt;%
              mutate(LOG_PRANK = log(PRANK),
                     LOG_VALUE = log(VALUE),
                     # Z value to normalize both
                     Z_PRANK = (LOG_PRANK - mean(LOG_PRANK)) / sd(LOG_PRANK),
                     Z_VAL = (LOG_VALUE - mean(LOG_VALUE)) / sd(LOG_VALUE),
                     # Rankings
                     R_VAL = rank(desc(VALUE), ties.method=&quot;first&quot;),
                     R_DIFF = R_PRANK - R_VAL,
                     HAS_DIFF = ifelse(R_DIFF == 0,&quot;NONE&quot;,REGION))

hist_input &lt;- select(pr_inputs, Z_VAL, Z_PRANK) %&gt;%
              gather(&quot;type&quot;,&quot;val&quot;) %&gt;%
              arrange(desc(type))

hist_plot &lt;- ggplot(hist_input) + 
             theme_lk() +
             theme(
               axis.ticks.x = element_blank(),
               axis.title.x = element_blank(),
               axis.text.x = element_blank(),
               axis.line.y = element_blank(),
               axis.ticks.y = element_blank(),
               axis.title.y = element_blank(),
               axis.text.y = element_blank()
             ) +
             scale_x_continuous(expand=c(0,0)) + 
             scale_y_continuous(expand=c(0,0)) +
             # Add Mean line
             geom_vline(data=data.frame(1), xintercept = 0, linetype=&quot;dashed&quot;, colour=ltxt_color) + 
             # Add descriptors
             geom_text(data=data.frame(x=c(0.1,-3,7),
                                        y=c(0.9,0.1,0.1),
                                        hjust=c(0,0,1),
                                        label=c(&quot;Mean&quot;,&quot;Less Important&quot;,&quot;More Important&quot;)),
                        aes(x=x, y=y, hjust=hjust, label=label),
                        colour = ltxt_color,
                        family = def_font) + 
             # Add geom density
             geom_density(aes(x=val, fill=type, colour=type), alpha=0.25) +
             scale_fill_manual(name=&quot;Methodology&quot;, values=get_color()[1:2], 
                               labels=c(&quot;Z_VAL&quot; = &quot;Imports + Exports&quot;,
                                        &quot;Z_PRANK&quot; = &quot;PageRank&quot;),
                               guide=guide_legend(override.aes = list(color = get_color()[1:2]))) +
             scale_color_manual(guide=&quot;none&quot;, values=get_color()[1:2])

hist_plot</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-27-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The plot above shows the distribution of <span class="hl blue-text">PageRank</span> and <span class="hl green-text">Imports + Export</span>. The latter distribution has a much gentler slope, implying that wildlife trade responsibilites are more “spread-out” across countries. <span class="hl">The PageRank algorithm, however, extremizes this distribution by compacting “average” countries into a single peak.</span> Only a handful of least and most important nations are left in the tails, allowing us to better distinguish them.</p>
<p>Secondly, let us investigate how the rankings shift as we transition from one approach to another:</p>
<pre class="r"><code>max_rank &lt;- 25
rank_plot &lt;- ggplot(pr_inputs, aes(colour=HAS_DIFF)) + 
              theme_void() +
              theme_lk(TRUE, FALSE, FALSE, FALSE) +
              # Prevent removing points or arrows outside the limit
              coord_cartesian(xlim = c(-2.0,max_rank + 0.5), ylim=c(-1.0,1.7)) +
              # Modify scales
              scale_x_continuous(expand=c(0,0.05)) +
              scale_y_continuous(expand=c(0,0.05)) +
              scale_color_manual(values=c(color_dictionary,&quot;NONE&quot;=fade_color(txt_color,0.2)),
                                 guide=&quot;none&quot;) +
              scale_size_continuous(guide=&quot;none&quot;) +
              # Add descriptors
              geom_text(data=data.frame(x=c(0.2,0.2,1.0,max_rank),
                                        y=c(0,1,-0.9,-0.9),
                                        hjust=c(1,1,0,1),
                                        label=c(&quot;Imports\n+ Exports&quot;,&quot;PageRank&quot;,
                                                &quot;More Important&quot;,&quot;Less Important&quot;)),
                        aes(x=x, y=y, hjust=hjust, label=label),
                        colour = ltxt_color,
                        family = def_font, 
                        size = 3) +
              geom_segment(data=data.frame(1),
                           aes(x=max_rank, xend=0.5,y=-0.8,yend=-0.8),
                           colour = ltxt_color,
                           arrow = arrow(length = unit(0.2,&quot;cm&quot;), type=&quot;closed&quot;)) +
              # Add imports + exports ranks
              geom_text(aes(x=R_VAL, y=-0.1, label=NAME_SHORT), angle=90, hjust=1, size = 3) +
              geom_point(aes(x=R_VAL, y=0, size=Z_VAL), alpha=0.5) +
              # Add pagerank probabilities
              geom_text(aes(x=R_PRANK, y=1.1, label=NAME_SHORT), angle=90, hjust=0, size = 3) + 
              geom_point(aes(x=R_PRANK, y=1.0, size=Z_PRANK), alpha=0.5) +
              # Add arrows
              geom_segment(aes(x=R_VAL, xend=R_PRANK, y=0.1, yend=0.9),
                           arrow = arrow(length = unit(0.2, &quot;cm&quot;), type=&quot;closed&quot;)) 

rank_plot</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-28-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>In both rankings, the top 6 countries remain the same. This implies that <span class="hl">imports and exports do play a prominent role in the PageRank algorithm.</span> However, the shifts in rankings also indicate that total trades is not the only factor influencing PageRank.</p>
<p>To identify other important factors, let us compare two countries that have been promoted and demoted extensively, <span class="hl orange-text">Japan</span> and <span class="hl blue-text">Ecuador</span>:</p>
<pre class="r"><code># Get edges only for neighbors of the two countries of interest
c_int &lt;- sort(c(&quot;JP&quot;,&quot;EC&quot;))
tc_edges &lt;- edges %&gt;%
            filter(v1 %in% c_int | v2 %in% c_int) %&gt;%
            filter(!(v1 == c_int[1] &amp; v2 == c_int[2]))

# Get only neighboring vertices
nodes_int &lt;- unique(c(tc_edges$v1, tc_edges$v2))
V1_vertice &lt;- (vertices %&gt;% filter(index == c_int[1]))
V2_vertice &lt;- (vertices %&gt;% filter(index == c_int[2]))
tc_vertices &lt;- vertices %&gt;% filter(index %in% nodes_int &amp; !(index %in% c_int))

# Construct Input
circ_input &lt;- tc_vertices %&gt;%
              mutate(x = rank(desc(PRANK),ties.method=&quot;first&quot;),
                     label = NAME_SHORT,
                     theta = 90 - x / nrow(tc_vertices) * 360)
circ_input$hjust &lt;- sapply(circ_input$theta, function(t) { if (t &lt;= -90){1} else {0}})
circ_input$theta &lt;- sapply(circ_input$theta, function (t) { if (t &lt;= -90) { t + 180} else {t}})

# Colors
neighbors_V1 &lt;- (tc_edges %&gt;% filter(v1 == c_int[1] | v2 == c_int[1]) %&gt;% mutate(v = ifelse(v1 == c_int[1],v2,v1)))$v
neighbors_V2 &lt;- (tc_edges %&gt;% filter(v1 == c_int[2] | v2 == c_int[2]) %&gt;% mutate(v = ifelse(v1 == c_int[2],v2,v1)))$v
circ_input$tag &lt;- sapply(tc_vertices$index, function (ix) {
                    if (ix %in% neighbors_V1 &amp; ix %in% neighbors_V2) { &quot;BOTH&quot; }
                    else if (ix %in% neighbors_V1) { c_int[1] }
                    else if (ix %in% neighbors_V2) { c_int[2] }
                    else { &quot;NONE&quot; }
                  })

compare_colors &lt;- c(fade_color(txt_color,0.2), color_dictionary[[V1_vertice$REGION]],color_dictionary[[V2_vertice$REGION]])
names(compare_colors) &lt;- c(&quot;BOTH&quot;, c_int)
compare_labels &lt;- c(&quot;Both&quot;,V1_vertice$NAME,V2_vertice$NAME)
names(compare_labels) &lt;- c(&quot;BOTH&quot;,c_int)
compare_plot &lt;- ggplot(circ_input, aes(x=x, y=1, size=PRANK, color=tag)) +
                theme_void() +
                theme_lk(TRUE, TRUE, FALSE, FALSE) +
                theme(plot.margin = unit(c(20,0,20,0),&#39;pt&#39;)) +
                scale_y_continuous(limits=c(0,1.15)) +
                # Add points, lines and labels of neighboring countries
                geom_point(alpha=0.5) + 
                geom_segment(data= circ_input %&gt;% filter(tag %in% c_int), 
                             aes(xend=x, y=0, yend=1, alpha=VALUE), 
                             size=0.5) +
                geom_text(data= circ_input %&gt;% filter(tag %in% c_int),
                          aes(label=label, angle=theta, hjust=hjust), 
                          y = 1.05, 
                          size=2.2,
                          show.legend = FALSE) +
                # Change Legends
                scale_size_continuous(name = &quot;PageRank&quot;,
                                      labels = percent) +
                scale_color_manual(name=&quot;Traded With&quot;,
                                   values = compare_colors,
                                   labels = compare_labels) +
                scale_alpha_continuous(guide=&quot;none&quot;) +
                # Change to coordinate polar
                coord_polar()

compare_plot</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-29-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The diagram above shows all the countries that either Japan or Ecuador traded with. It is clear that Japan has a greater outreach than Ecuador, even though the latter has a higher total imports + exports. <span class="hl">This degree of outreach caused the algorithm to promote <span class="orange-text">Japan</span> at the expense of <span class="blue-text">Ecuador</span>.</span></p>
</section>

<section id="decomposing-pagerank" class="level4">
<h4>Decomposing PageRank</h4>
<p>The PageRank algorithm allows us to determine who the major players are. However, each country has different roles to play. Some can be <span class="hl">consumers</span> (countries which fuel the demand of wildlife consumption), <span class="hl">suppliers</span> (countries which capture the wildlife and ship them out) or even <span class="hl">dealers</span> (intermediaries which connect suppliers and consumers). To reduce wildlife trading effectively, tackling different roles will require different strategies.</p>
<p><span class="hl">In this section, we will construct a method to identify the top consumers, dealers and suppliers.</span> It is important to note that these roles are not exclusive; a country may well be a supplier of one species and a consumer of another.</p>
<p>To determine a country’s role, we will first split the quantity traded of each species into three constituents:</p>
<ul>
<li><span class="hl">Net Imports</span>: The amount of trades being brought into the country. This is the leftover amount when we subtract imports with exports. If exports are more than imports, then there are no net imports.</li>
<li><span class="hl">Net Exports</span>: The amount of trades being shipped out of the country. This is equivalent to the amount remaining when we subtract exports with imports. If imports are more than exports, there are no net exports.</li>
<li><span class="hl">Transits</span>: These are the trades being brought in and then shipped out of the country. This is equivalent to the minimum of Exports and Imports.</li>
</ul>
<p>These constitutients are then summed up across species to determine a country’s net imports, net exports and transits. Thee 3 values are subsequently used to decompose PageRank via the following approach:</p>
<pre class="r"><code>grViz(paste0(&quot;
  digraph decomPR {

    # Default Specs
    graph [compound = true, nodesep = .5, ranksep = .25]
    node [fontname = &#39;&quot;,def_font,&quot;&#39;, fontsize = 14, fontcolor = &#39;&quot;,bg_color,&quot;&#39;, penwidth=0, color=&#39;&quot;,ltxt_color,&quot;&#39;, style=filled, shape = oval]
    edge [fontname = &#39;&quot;,def_font,&quot;&#39;, fontcolor = &#39;&quot;,ltxt_color,&quot;&#39;, color=&#39;&quot;,ltxt_color,&quot;&#39;]
    
    PageRank [fillcolor = &#39;&quot;,ltxt_color,&quot;&#39;, shape=diamond]
    ConsumerRank [fillcolor = &#39;&quot;,get_color(&quot;red&quot;),&quot;&#39;]
    DealerRank [fillcolor = &#39;&quot;,sec_color,&quot;&#39;]
    SupplierRank [fillcolor = &#39;&quot;,get_color(&quot;purple&quot;),&quot;&#39;]

    PageRank -&gt; ConsumerRank [ label=&#39; x Net Imports %&#39; ]
    PageRank-&gt; DealerRank [ label=&#39;  x Transit %&#39; ]
    PageRank -&gt; SupplierRank [ label=&#39;  x Net Exports %&#39; ]
  }
&quot;), width=405, height=100)</code></pre>
<div id="htmlwidget-29a5e7e6fa1a94b51cc0" style="width:405px;height:100px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-29a5e7e6fa1a94b51cc0">{"x":{"diagram":"\n  digraph decomPR {\n\n    # Default Specs\n    graph [compound = true, nodesep = .5, ranksep = .25]\n    node [fontname = \"IBM Plex Sans\", fontsize = 14, fontcolor = \"#ffffff\", penwidth=0, color=\"#424242BF\", style=filled, shape = oval]\n    edge [fontname = \"IBM Plex Sans\", fontcolor = \"#424242BF\", color=\"#424242BF\"]\n    \n    PageRank [fillcolor = \"#424242BF\", shape=diamond]\n    ConsumerRank [fillcolor = \"#A43820\"]\n    DealerRank [fillcolor = \"#304a68\"]\n    SupplierRank [fillcolor = \"#5C3C7C\"]\n\n    PageRank -> ConsumerRank [ label=\" x Net Imports %\" ]\n    PageRank-> DealerRank [ label=\"  x Transit %\" ]\n    PageRank -> SupplierRank [ label=\"  x Net Exports %\" ]\n  }\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>where</p>
<ul>
<li><span class="hl red-text">ConsumerRank</span> is the % of trades due to the country’s <span class="hl red-text">consumption</span>,</li>
<li><span class="hl">DealerRank</span> is the % of trades due to the country <span class="hl">being an intermediary</span>, and</li>
<li><span class="hl purple-text">SupplierRank</span> is the % of trades due to the country’s <span class="hl purple-text">provision<span>.</li>
</ul>
<p>By ordering each of these three ranks, we can determine which countries are the top consumers, dealers and suppliers. Summing up each of these metrics would also allow us to determine the major drivers behind wildlife trading:</p>
<pre class="r"><code># Calculate the Net Exports and Imports for each country at a specified level of taxonomy granularity
net_gross_p_country &lt;- function(granularity=&quot;Taxon&quot;) {
  
  imports &lt;- dataset %&gt;% 
    group_by_at(vars(&quot;Importer&quot;, granularity)) %&gt;% 
    summarise(Imports = sum(Qty)) %&gt;% ungroup()
  exports &lt;- dataset %&gt;% 
    group_by_at(vars(&quot;Exporter&quot;, granularity)) %&gt;% 
    summarise(Exports = sum(Qty)) %&gt;% ungroup()
  
  by_joins &lt;- c(&quot;Exporter&quot;,granularity)
  names(by_joins) &lt;- c(&quot;Importer&quot;,granularity)

  trades &lt;- imports %&gt;% 
    full_join(exports, by=by_joins) %&gt;%
    mutate(
      index = Importer,
      Imports = ifelse(is.na(Imports),0,Imports),
      Exports = ifelse(is.na(Exports),0,Exports),
      Gross = Imports + Exports,
      Net_Exports = ifelse(Exports &gt; Imports, Exports - Imports,0),
      Net_Imports = ifelse(Imports &gt; Exports, Imports - Exports,0),
      # Trades that are not supplied [net export] or consumed [net imports] are ones
      # that are being transited within the country
      Transits = ifelse(Imports &gt; Exports, Exports, Imports)
    )
  trades %&gt;% select_at(vars(&quot;index&quot;,granularity,&quot;Imports&quot;,&quot;Exports&quot;,&quot;Gross&quot;,&quot;Net_Exports&quot;,&quot;Net_Imports&quot;,&quot;Transits&quot;))
}
country_taxon_trades &lt;- net_gross_p_country()

# Calculate the demand, supply and dealer rankings for each country using the following:
# ConsumerRank: net imports / gross * PageRank
# SupplierRank: net exports / gross * PageRank
# DealerRank: transits / gross * PageRank
country_add_info &lt;- country_taxon_trades %&gt;%
                      group_by(index) %&gt;%
                      summarise(GROSS = sum(Gross),
                                NET_IMPORTS = sum(Net_Imports),
                                NET_EXPORTS = sum(Net_Exports),
                                TRANSITS = sum(Transits))

vertices &lt;- vertices %&gt;%
            left_join(country_add_info, country_add_info, by=&quot;index&quot;) %&gt;%
            mutate(
              CRANK = NET_IMPORTS / GROSS * PRANK,
              R_CRANK = rank(desc(CRANK), ties.method=&quot;first&quot;),
              DRANK = TRANSITS / GROSS * PRANK,
              R_DRANK = rank(desc(DRANK), ties.method=&quot;first&quot;),
              SRANK = NET_EXPORTS / GROSS * PRANK,
              R_SRANK = rank(desc(SRANK), ties.method=&quot;first&quot;)
            )

&quot;% Trade Contribution by Roles:\n&quot; %&gt;%
paste0(paste0(sapply(c(&quot;CRANK&quot;,&quot;DRANK&quot;,&quot;SRANK&quot;), function(r) {  
    sprintf(&quot;%ss: %.2f%%&quot;, ifelse(r == &quot;CRANK&quot;,&quot;Consumer&quot;, ifelse(r == &quot;DRANK&quot;,&quot;Dealer&quot;,&quot;Supplier&quot;)),sum(vertices[r]) * 100)
  }), collapse=&quot;\n&quot;)) %&gt;%
cat()</code></pre>
<pre><code>## % Trade Contribution by Roles:
## Consumers: 45.81%
## Dealers: 4.07%
## Suppliers: 46.04%</code></pre>
<p>From the above summary, consumption and supply of wildlife goods contribute the most to wildlife exchanges. Intermediaries surprisingly do not play major roles. This suggests that to reduce trading, we are better off focusing on reducing supply and demand (instead of breaking down the channels connecting them).</p>
<pre class="r"><code># Normalize each of the ranks so that totals of each rank = 1
leaf_inputs &lt;- vertices %&gt;%
                mutate(
                  CRANK = CRANK / sum(CRANK),
                  DRANK = DRANK / sum(DRANK),
                  SRANK = SRANK / sum(SRANK)
                )

# Get only the top countries to show degree of roles
n_show &lt;- 12
leaf_inputs &lt;- leaf_inputs %&gt;% arrange(desc(PRANK)) %&gt;% head(n_show)
leaf_inputs$NAME &lt;- factor(leaf_inputs$NAME, levels=unique(leaf_inputs$NAME))

# Normalize between the three ranks to make sure that plot is properly &quot;zoomed&quot;
# as free_y is not available for polar coordinates
leaf_inputs$MAXR &lt;- sapply(1:nrow(leaf_inputs), function(i) {
  max(leaf_inputs[i,&quot;CRANK&quot;],leaf_inputs[i,&quot;DRANK&quot;],leaf_inputs[i,&quot;SRANK&quot;])
})
leaf_inputs &lt;- leaf_inputs %&gt;%
                mutate(
                  CRANK = CRANK / MAXR,
                  DRANK = DRANK / MAXR,
                  SRANK = SRANK / MAXR,
                  CLOSE = CRANK
                ) %&gt;%
                gather(&quot;Key&quot;,&quot;Value&quot;, CRANK, DRANK, SRANK, CLOSE) %&gt;%
                mutate(
                  Key = ifelse(Key == &quot;CRANK&quot;,0,
                               ifelse(Key == &quot;DRANK&quot;,120,
                                      ifelse(Key == &quot;SRANK&quot;,240,
                                             ifelse(Key == &quot;CLOSE&quot;,360,0))))
                ) %&gt;%
                select(NAME, REGION, PRANK, Key, Value)

# Plot!
leaf_plot &lt;- ggplot(leaf_inputs, aes(x=Key, y=Value, fill=REGION, color=REGION)) + 
              coord_polar(start=60/180*pi) +
              theme_lk(TRUE, TRUE, FALSE, FALSE) + 
              theme(
                axis.line.x = element_blank(),
                axis.ticks.x = element_blank(),
                axis.title.x = element_blank(),
                axis.text.x = element_text(colour=ltxt_color, size = 8, angle=c(-60,0,60)),
                panel.grid.major.x = element_line(colour=fade_color(txt_color,0.2)),
                axis.line.y = element_blank(),
                axis.ticks.y = element_blank(),
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                panel.grid.major.y = element_blank(),
                strip.background = element_blank(),
                strip.text.x = element_blank()
              ) + 
              scale_x_continuous(limits=c(0,360), 
                                 breaks = c(0,120,240), 
                                 labels=c(&quot;Consumer&quot;,&quot;Dealer&quot;,&quot;Supplier&quot;),
                                 minor_breaks = NULL) +
              scale_y_continuous(limits=c(0,NA)) +
              scale_fill_manual(values = color_dictionary, guide = &quot;none&quot;) + 
              scale_color_manual(values = color_dictionary,guide = &quot;none&quot;) +
              geom_polygon(alpha=0.2, size=0) + 
              geom_text(data=leaf_inputs %&gt;% select(NAME, REGION) %&gt;% unique(),
                        aes(label=NAME),
                        x=0,y=0, 
                        family=def_font,
                        alpha=0.9) + 
              facet_wrap(~NAME)

suppressWarnings(print(leaf_plot))</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-32-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The leaf plots above show the roles played by the top 12 countries. <span class="hl blue-text">United States</span>, the biggest player, are mostly consumers, while <span class="hl red-text">Germany</span> is a large dealer. <span class="hl orange-text">China</span> unsurprisingly is both consuming and supplying wildlife resources.</p>
</section>
</section>
<section id="the-major-players" class="level3">
<h3>The Major Players</h3>
<p>Listed below are the top consumers, dealers and suppliers detected through the PageRank algorithm.</p>
<pre class="r"><code>to_text &lt;- function (data) {
  tmp &lt;- data %&gt;% head(5)
  tmp$NAME
}

consumers &lt;- vertices %&gt;% arrange(R_CRANK)
dealers &lt;- vertices %&gt;% arrange(R_DRANK)
suppliers &lt;- vertices %&gt;% arrange(R_SRANK)

players &lt;- data.frame(&quot;Consumers&quot;=to_text(consumers),
                      &quot;Dealers&quot;=to_text(dealers),
                      &quot;Suppliers&quot;=to_text(suppliers))

pander(players, caption=&quot;The Top Suppliers, Dealers and Consumers&quot;)</code></pre>
<div class="table-responsive"><table style="width:76%;">
<caption>The Top Suppliers, Dealers and Consumers</caption>
<colgroup>
<col style="width: 29%" />
<col style="width: 31%" />
<col style="width: 15%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Consumers</th>
<th style="text-align: left;">Dealers</th>
<th style="text-align: left;">Suppliers</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">United States</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: left;">Indonesia</td>
</tr>
<tr class="even">
<td style="text-align: left;">China</td>
<td style="text-align: left;">United States</td>
<td style="text-align: left;">Mexico</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Japan</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">Ecuador</td>
</tr>
<tr class="even">
<td style="text-align: left;">Korea, Republic of</td>
<td style="text-align: left;">France</td>
<td style="text-align: left;">China</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hong Kong</td>
<td style="text-align: left;">United Arab Emirates</td>
<td style="text-align: left;">Fiji</td>
</tr>
</tbody>
</table></div>
<p>To find out more about each country’s trading activities, please hover or click on the buttons below:</p>

<section id="consumers" class="level4">
<h4>Consumers</h4>
<div class="players-container">
<a class="players" data-toggle="popover" data-html="true" title="" data-content="<span style='font-size:0.8em'>PageRank:</span> <span class='hl' style='color: #A43820'>1st</span><br><span style='font-size:0.8em'>ConsumerRank:</span> <span class='hl' style='color: #A43820'>1st</span><br><span style='font-size:0.8em'>DealerRank:</span> <span class='hl' style='color: #A43820'>2nd</span><br><span style='font-size:0.8em'>SupplierRank:</span> <span class='hl' style='color: #A43820'>10th</span><br><span style='font-size:0.8em'>Imports/Exports:</span> <span class='hl' style='color: #A43820'>10,272,642/894,531</span><br><br><span style='font-size:0.8em'>Top Imported Species [Net Imports]</span>:<br>Brown Sea Cucumber<sup></sup> [1,819,917]<br>Heliofungia actiniformis<sup></sup> [971,508]<br>Euphyllia cristata<sup></sup> [917,220]<br>Catalaphyllia jardinei<sup></sup> [801,253]<br>Euphyllia ancora<sup></sup> [786,429]<br>" data-original-title="<span style='color: #A43820'>United States</span>"><img src="img/us.png"></a><a class="players" data-toggle="popover" data-html="true" title="" data-content="<span style='font-size:0.8em'>PageRank:</span> <span class='hl' style='color: #A43820'>3rd</span><br><span style='font-size:0.8em'>ConsumerRank:</span> <span class='hl' style='color: #A43820'>2nd</span><br><span style='font-size:0.8em'>DealerRank:</span> <span class='hl' style='color: #A43820'>6th</span><br><span style='font-size:0.8em'>SupplierRank:</span> <span class='hl' style='color: #A43820'>4th</span><br><span style='font-size:0.8em'>Imports/Exports:</span> <span class='hl' style='color: #A43820'>5,597,436/3,042,290</span><br><br><span style='font-size:0.8em'>Top Imported Species [Net Imports]</span>:<br>Brown Sea Cucumber<sup></sup> [4,378,790]<br>Giant Seahorse<sup></sup> [299,377]<br>Southeast Asian Box Turtle<sup></sup> [254,622]<br>Alligator Snapping Turtle<sup></sup> [79,354]<br>Asiatic Softshell Turtle<sup></sup> [77,621]<br>" data-original-title="<span style='color: #A43820'>China</span>"><img src="img/cn.png"></a><a class="players" data-toggle="popover" data-html="true" title="" data-content="<span style='font-size:0.8em'>PageRank:</span> <span class='hl' style='color: #A43820'>4th</span><br><span style='font-size:0.8em'>ConsumerRank:</span> <span class='hl' style='color: #A43820'>3rd</span><br><span style='font-size:0.8em'>DealerRank:</span> <span class='hl' style='color: #A43820'>12th</span><br><span style='font-size:0.8em'>SupplierRank:</span> <span class='hl' style='color: #A43820'>181st</span><br><span style='font-size:0.8em'>Imports/Exports:</span> <span class='hl' style='color: #A43820'>3,698,792/74,877</span><br><br><span style='font-size:0.8em'>Top Imported Species [Net Imports]</span>:<br>European Eel<sup></sup> [2,456,741]<br>Heliofungia actiniformis<sup></sup> [197,506]<br>Euphyllia cristata<sup></sup> [96,199]<br>Catalaphyllia jardinei<sup></sup> [93,421]<br>Stellate Sturgeon<sup></sup> [75,145]<br>" data-original-title="<span style='color: #A43820'>Japan</span>"><img src="img/jp.png"></a><a class="players" data-toggle="popover" data-html="true" title="" data-content="<span style='font-size:0.8em'>PageRank:</span> <span class='hl' style='color: #A43820'>9th</span><br><span style='font-size:0.8em'>ConsumerRank:</span> <span class='hl' style='color: #A43820'>4th</span><br><span style='font-size:0.8em'>DealerRank:</span> <span class='hl' style='color: #A43820'>23rd</span><br><span style='font-size:0.8em'>SupplierRank:</span> <span class='hl' style='color: #A43820'>213th</span><br><span style='font-size:0.8em'>Imports/Exports:</span> <span class='hl' style='color: #A43820'>1,753,371/33,224</span><br><br><span style='font-size:0.8em'>Top Imported Species [Net Imports]</span>:<br>European Eel<sup></sup> [1,487,237]<br>Heliofungia actiniformis<sup></sup> [43,374]<br>Russian Sturgeon<sup></sup> [21,456]<br>Porites nigrescens<sup></sup> [20,133]<br>Stellate Sturgeon<sup></sup> [16,320]<br>" data-original-title="<span style='color: #A43820'>Korea, Republic of</span>"><img src="img/kr.png"></a><a class="players" data-toggle="popover" data-html="true" title="" data-content="<span style='font-size:0.8em'>PageRank:</span> <span class='hl' style='color: #A43820'>10th</span><br><span style='font-size:0.8em'>ConsumerRank:</span> <span class='hl' style='color: #A43820'>5th</span><br><span style='font-size:0.8em'>DealerRank:</span> <span class='hl' style='color: #A43820'>19th</span><br><span style='font-size:0.8em'>SupplierRank:</span> <span class='hl' style='color: #A43820'>118th</span><br><span style='font-size:0.8em'>Imports/Exports:</span> <span class='hl' style='color: #A43820'>1,502,256/79,174</span><br><br><span style='font-size:0.8em'>Top Imported Species [Net Imports]</span>:<br>European Eel<sup></sup> [290,955]<br>Southeast Asian Box Turtle<sup></sup> [257,160]<br>Alligator Snapping Turtle<sup></sup> [203,798]<br>Brown Sea Cucumber<sup></sup> [116,530]<br>Asiatic Softshell Turtle<sup></sup> [91,368]<br>" data-original-title="<span style='color: #A43820'>Hong Kong</span>"><img src="img/hk.png"></a>
</div>
<div style="font-size:0.9em; color: var(--font-color-75); text-align:right; padding:1em">
Icons courtesy of <a href="http://www.customicondesign.com/free-icons/flag-icon-set/flat-round-world-flag-icon-set/" target="_blank">Custom Icon Design</a>
</div>
</section>
<section id="dealers" class="level4">
<h4>Dealers</h4>
<div class="players-container">
<a class="players" data-toggle="popover" data-html="true" title="" data-content="<span style='font-size:0.8em'>PageRank:</span> <span class='hl' style='color: #154376'>7th</span><br><span style='font-size:0.8em'>ConsumerRank:</span> <span class='hl' style='color: #154376'>8th</span><br><span style='font-size:0.8em'>DealerRank:</span> <span class='hl' style='color: #154376'>1st</span><br><span style='font-size:0.8em'>SupplierRank:</span> <span class='hl' style='color: #154376'>34th</span><br><span style='font-size:0.8em'>Imports/Exports:</span> <span class='hl' style='color: #154376'>1,006,554/423,517</span><br><br><span style='font-size:0.8em'>Top Transit Species [Quantity]</span>:<br>Stellate Sturgeon<sup></sup> [129,157]<br>Russian Sturgeon<sup></sup> [71,943]<br>Persian Sturgeon<sup></sup> [63,711]<br>Paddlefish<sup></sup> [23,763]<br>European Eel<sup></sup> [23,713]<br>" data-original-title="<span style='color: #154376'>Germany</span>"><img src="img/de.png"></a><a class="players" data-toggle="popover" data-html="true" title="" data-content="<span style='font-size:0.8em'>PageRank:</span> <span class='hl' style='color: #154376'>1st</span><br><span style='font-size:0.8em'>ConsumerRank:</span> <span class='hl' style='color: #154376'>1st</span><br><span style='font-size:0.8em'>DealerRank:</span> <span class='hl' style='color: #154376'>2nd</span><br><span style='font-size:0.8em'>SupplierRank:</span> <span class='hl' style='color: #154376'>10th</span><br><span style='font-size:0.8em'>Imports/Exports:</span> <span class='hl' style='color: #154376'>10,272,642/894,531</span><br><br><span style='font-size:0.8em'>Top Transit Species [Quantity]</span>:<br>Stellate Sturgeon<sup></sup> [73,489]<br>Euphyllia ancora<sup></sup> [21,072]<br>Brown Sea Cucumber<sup></sup> [19,566]<br>Catalaphyllia jardinei<sup></sup> [19,432]<br>Euphyllia cristata<sup></sup> [17,061]<br>" data-original-title="<span style='color: #154376'>United States</span>"><img src="img/us.png"></a><a class="players" data-toggle="popover" data-html="true" title="" data-content="<span style='font-size:0.8em'>PageRank:</span> <span class='hl' style='color: #154376'>14th</span><br><span style='font-size:0.8em'>ConsumerRank:</span> <span class='hl' style='color: #154376'>19th</span><br><span style='font-size:0.8em'>DealerRank:</span> <span class='hl' style='color: #154376'>3rd</span><br><span style='font-size:0.8em'>SupplierRank:</span> <span class='hl' style='color: #154376'>159th</span><br><span style='font-size:0.8em'>Imports/Exports:</span> <span class='hl' style='color: #154376'>392,213/221,774</span><br><br><span style='font-size:0.8em'>Top Transit Species [Quantity]</span>:<br>Stellate Sturgeon<sup></sup> [92,102]<br>Persian Sturgeon<sup></sup> [57,885]<br>Russian Sturgeon<sup></sup> [44,896]<br>Burmese Python<sup></sup> [6,741]<br>Beluga<sup></sup> [6,411]<br>" data-original-title="<span style='color: #154376'>Switzerland</span>"><img src="img/ch.png"></a><a class="players" data-toggle="popover" data-html="true" title="" data-content="<span style='font-size:0.8em'>PageRank:</span> <span class='hl' style='color: #154376'>8th</span><br><span style='font-size:0.8em'>ConsumerRank:</span> <span class='hl' style='color: #154376'>6th</span><br><span style='font-size:0.8em'>DealerRank:</span> <span class='hl' style='color: #154376'>4th</span><br><span style='font-size:0.8em'>SupplierRank:</span> <span class='hl' style='color: #154376'>17th</span><br><span style='font-size:0.8em'>Imports/Exports:</span> <span class='hl' style='color: #154376'>847,092/452,671</span><br><br><span style='font-size:0.8em'>Top Transit Species [Quantity]</span>:<br>Stellate Sturgeon<sup></sup> [76,360]<br>Persian Sturgeon<sup></sup> [52,571]<br>Russian Sturgeon<sup></sup> [27,300]<br>European Eel<sup>1</sup> [8,645]<br>Beluga<sup></sup> [8,534]<br><br><div style='font-size:0.7em; line-height: 1.15;'><sup>1</sup>Due to missing black market exports, France is considered an intermediary stop for European Eels, even though they originate from the country. See Limitations.<br></div>" data-original-title="<span style='color: #154376'>France</span>"><img src="img/fr.png"></a><a class="players" data-toggle="popover" data-html="true" title="" data-content="<span style='font-size:0.8em'>PageRank:</span> <span class='hl' style='color: #154376'>21st</span><br><span style='font-size:0.8em'>ConsumerRank:</span> <span class='hl' style='color: #154376'>27th</span><br><span style='font-size:0.8em'>DealerRank:</span> <span class='hl' style='color: #154376'>5th</span><br><span style='font-size:0.8em'>SupplierRank:</span> <span class='hl' style='color: #154376'>157th</span><br><span style='font-size:0.8em'>Imports/Exports:</span> <span class='hl' style='color: #154376'>209,486/148,187</span><br><br><span style='font-size:0.8em'>Top Transit Species [Quantity]</span>:<br>Stellate Sturgeon<sup></sup> [61,350]<br>Persian Sturgeon<sup></sup> [35,164]<br>Russian Sturgeon<sup></sup> [23,980]<br>Paddlefish<sup></sup> [10,812]<br>Beluga<sup></sup> [4,608]<br>" data-original-title="<span style='color: #154376'>United Arab Emirates</span>"><img src="img/ae.png"></a>
</div>
<div style="font-size:0.9em; color: var(--font-color-75); text-align:right; padding:1em">
Icons courtesy of <a href="http://www.customicondesign.com/free-icons/flag-icon-set/flat-round-world-flag-icon-set/" target="_blank">Custom Icon Design</a>
</div>
</section>
<section id="suppliers" class="level4">
<h4>Suppliers</h4>
<div class="players-container">
<a class="players" data-toggle="popover" data-html="true" title="" data-content="<span style='font-size:0.8em'>PageRank:</span> <span class='hl' style='color: #5C3C7C'>2nd</span><br><span style='font-size:0.8em'>ConsumerRank:</span> <span class='hl' style='color: #5C3C7C'>139th</span><br><span style='font-size:0.8em'>DealerRank:</span> <span class='hl' style='color: #5C3C7C'>109th</span><br><span style='font-size:0.8em'>SupplierRank:</span> <span class='hl' style='color: #5C3C7C'>1st</span><br><span style='font-size:0.8em'>Imports/Exports:</span> <span class='hl' style='color: #5C3C7C'>7,616/8,326,995</span><br><br><span style='font-size:0.8em'>Top Exported Species [Net Exports]</span>:<br>Heliofungia actiniformis<sup></sup> [1,678,527]<br>Euphyllia cristata<sup></sup> [1,136,982]<br>Euphyllia ancora<sup></sup> [1,029,110]<br>Catalaphyllia jardinei<sup></sup> [999,754]<br>Turbinaria peltata<sup></sup> [679,520]<br>" data-original-title="<span style='color: #5C3C7C'>Indonesia</span>"><img src="img/id.png"></a><a class="players" data-toggle="popover" data-html="true" title="" data-content="<span style='font-size:0.8em'>PageRank:</span> <span class='hl' style='color: #5C3C7C'>5th</span><br><span style='font-size:0.8em'>ConsumerRank:</span> <span class='hl' style='color: #5C3C7C'>31st</span><br><span style='font-size:0.8em'>DealerRank:</span> <span class='hl' style='color: #5C3C7C'>52nd</span><br><span style='font-size:0.8em'>SupplierRank:</span> <span class='hl' style='color: #5C3C7C'>2nd</span><br><span style='font-size:0.8em'>Imports/Exports:</span> <span class='hl' style='color: #5C3C7C'>114,457/2,731,569</span><br><br><span style='font-size:0.8em'>Top Exported Species [Net Exports]</span>:<br>Brown Sea Cucumber<sup></sup> [2,162,959]<br>European Eel<sup>1</sup> [463,804]<br>Black-footed Ferret<sup></sup> [68,073]<br>Giant Seahorse<sup></sup> [5,383]<br>Kemp's Ridley<sup></sup> [5,054]<br><br><div style='font-size:0.7em; line-height: 1.15;'><sup>1</sup>Due to missing black market imports, European Eels are considered as top providers for Mexico. See Limitations.<br></div>" data-original-title="<span style='color: #5C3C7C'>Mexico</span>"><img src="img/mx.png"></a><a class="players" data-toggle="popover" data-html="true" title="" data-content="<span style='font-size:0.8em'>PageRank:</span> <span class='hl' style='color: #5C3C7C'>6th</span><br><span style='font-size:0.8em'>ConsumerRank:</span> <span class='hl' style='color: #5C3C7C'>206th</span><br><span style='font-size:0.8em'>DealerRank:</span> <span class='hl' style='color: #5C3C7C'>177th</span><br><span style='font-size:0.8em'>SupplierRank:</span> <span class='hl' style='color: #5C3C7C'>3rd</span><br><span style='font-size:0.8em'>Imports/Exports:</span> <span class='hl' style='color: #5C3C7C'>141/4,182,891</span><br><br><span style='font-size:0.8em'>Top Exported Species [Net Exports]</span>:<br>Brown Sea Cucumber<sup></sup> [4,172,968]<br>El Oro Parakeet<sup></sup> [2,280]<br>Fernandina Marine Iguana<sup></sup> [2,057]<br>Common Land Iguana<sup></sup> [1,486]<br>Fungia curvata<sup></sup> [754]<br>" data-original-title="<span style='color: #5C3C7C'>Ecuador</span>"><img src="img/ec.png"></a><a class="players" data-toggle="popover" data-html="true" title="" data-content="<span style='font-size:0.8em'>PageRank:</span> <span class='hl' style='color: #5C3C7C'>3rd</span><br><span style='font-size:0.8em'>ConsumerRank:</span> <span class='hl' style='color: #5C3C7C'>2nd</span><br><span style='font-size:0.8em'>DealerRank:</span> <span class='hl' style='color: #5C3C7C'>6th</span><br><span style='font-size:0.8em'>SupplierRank:</span> <span class='hl' style='color: #5C3C7C'>4th</span><br><span style='font-size:0.8em'>Imports/Exports:</span> <span class='hl' style='color: #5C3C7C'>5,597,436/3,042,290</span><br><br><span style='font-size:0.8em'>Top Exported Species [Net Exports]</span>:<br>European Eel<sup>1</sup> [2,718,363]<br>Chinese Stripe-necked Turtle<sup></sup> [82,313]<br>Reeves' Turtle<sup></sup> [61,683]<br>Amur Sturgeon<sup></sup> [9,527]<br>Burmese Python<sup></sup> [7,206]<br><br><div style='font-size:0.7em; line-height: 1.15;'><sup>1</sup>Due to missing black market imports, European Eels are considered as top providers for China. See Limitations.<br></div>" data-original-title="<span style='color: #5C3C7C'>China</span>"><img src="img/cn.png"></a><a class="players" data-toggle="popover" data-html="true" title="" data-content="<span style='font-size:0.8em'>PageRank:</span> <span class='hl' style='color: #5C3C7C'>11th</span><br><span style='font-size:0.8em'>ConsumerRank:</span> <span class='hl' style='color: #5C3C7C'>191st</span><br><span style='font-size:0.8em'>DealerRank:</span> <span class='hl' style='color: #5C3C7C'>48th</span><br><span style='font-size:0.8em'>SupplierRank:</span> <span class='hl' style='color: #5C3C7C'>5th</span><br><span style='font-size:0.8em'>Imports/Exports:</span> <span class='hl' style='color: #5C3C7C'>6,943/1,140,039</span><br><br><span style='font-size:0.8em'>Top Exported Species [Net Exports]</span>:<br>Pavona cactus<sup></sup> [208,364]<br>Turbinaria reniformis<sup></sup> [84,018]<br>Acropora vaughani<sup></sup> [83,798]<br>Acropora horrida<sup></sup> [80,321]<br>Pachyseris rugosa<sup></sup> [77,811]<br>" data-original-title="<span style='color: #5C3C7C'>Fiji</span>"><img src="img/fj.png"></a>
</div>
<div style="font-size:0.9em; color: var(--font-color-75); text-align:right; padding:1em">
Icons courtesy of <a href="http://www.customicondesign.com/free-icons/flag-icon-set/flat-round-world-flag-icon-set/" target="_blank">Custom Icon Design</a>
</div>
</section>
</section>
</section>
<section id="summary-of-results" class="level2">
<h2>Summary of Results</h2>
<p>By standardizing terms through <a href="#the-roll-up-median-approach">the roll-up median approach</a> and ranking countries via <a href="#the-pagerank-algorithm">the PageRank algorithm</a>, we have identified the major players in endangered wildlife trade:</p>
<ul>
<li><span class="hl">Consumers</span> are countries which generate the demand for wildlife. It is important to educate citizens in these countries to stop using wildlife products. The top 5 consumers are <span class="hl">United States</span>, <span class="hl">China</span>, <span class="hl">Japan</span>, <span class="hl">Korea</span>, <span class="hl">Hong Kong</span>.</li>
<li><span class="hl">Dealers</span> are countries which connect suppliers to consumers. More stringent measures can be set up in the trading ports to reduce endangered wildlife trading. The top 5 dealers are <span class="hl">Germany</span>, <span class="hl">United States</span>, <span class="hl">Switzerland</span>, <span class="hl">France</span>, <span class="hl">United Arab Emirates</span>.</li>
<li><span class="hl">Suppliers</span> are countries that provide wildlife goods. Efforts to protect the nature reserves of these countries should be emphasized. The top 5 suppliers are <span class="hl">Indonesia</span>, <span class="hl">Mexico</span>, <span class="hl">Ecuador</span>, <span class="hl">China</span>, <span class="hl">Fiji</span>.</li>
</ul>
</section>
<section id="limitations" class="level2">
<h2>Limitations</h2>
<p>The above analysis, though simplified, provides us with a better picture of the wildlife situation across the world. Listed below are some suggestions to improve the accuracy of results:</p>
<ul>
<li><span class="hl">One Side of the Story</span>: This study is based on data reported by governments. As such, many black market trades are missing. It would be interesting to identify these “shadow” trades by verifying the consistency of the CITES data, before integrating them back into this analysis.</li>
<li><span class="hl">Wild</span>: Due to size constraints, we only considered trades whose sources are tagged as “Wild”. By expanding the scope, additional insights could be unearthed.</li>
<li><span class="hl">Species-Specific Fixes</span>: The methods in pre-processing are generalized and favor expediency over accuracy. By fixing each trade according to individual species’s characteristics (such as weight), we can obtain more accurate transformations of the terms into animal counts.</li>
</ul>
</section>
<section id="references" class="level2">
<h2>References</h2>
<p>CITES Database 2017. <a href="https://www.cites.org" class="uri">https://www.cites.org</a>. Downloaded on 24 April 2018.</p>
<p>IUCN 2017. The IUCN Red List of Threatened Species. Version 2017-3. <a href="http://www.iucnredlist.org" class="uri">http://www.iucnredlist.org</a>. Downloaded on 25 April 2018.</p>
</section>

-->


</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
