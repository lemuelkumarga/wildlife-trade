<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Lemuel Kumarga" />


<title>Identifying Major Players in Endangered Wildlife Trade</title>

<script src="index_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="index_files/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="index_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="index_files/navigation-1.1/tabsets.js"></script>
<script src="index_files/navigation-1.1/codefolding.js"></script>
<link href="index_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="index_files/highlightjs-9.12.0/highlight.js"></script>
<script src="index_files/htmlwidgets-1.2/htmlwidgets.js"></script>
<script src="index_files/viz-0.3/viz.js"></script>
<link href="index_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="index_files/grViz-binding-1.0.0/grViz.js"></script>
<script src="shared/js/popover.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="shared/css/defaults.css" />
<link rel="stylesheet" href="shared/css/defaults.css" />
<link rel="stylesheet" href="../../shared/css/definitions.css" />
<link rel="stylesheet" href="shared/css/defaults.css" />
<link rel="stylesheet" href="shared/css/defaults.css" />
<link rel="stylesheet" href="../../shared/css/definitions.css" />
<link rel="stylesheet" href="../../shared/css/general.css" />
<link rel="stylesheet" href="shared/css/Rmd.css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>






<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Identifying Major Players in Endangered Wildlife Trade</h1>
<h4 class="author"><em><span class="meta">Lemuel Kumarga</span></em></h4>
<h4 class="date"><em><span class="meta">May 2018</span></em></h4>

</div>


<section id="problem-description" class="level2">
<h2>Problem Description</h2>
<p>Since the Stone Age, mankind has turned to nature for food, commerce and companionship. Our impact back then was minimal as resources were consumed at sustainable rates. However, over the past few decades, nature is increasingly under threat from overconsumption and excess capitalism. Our planet is facing multiple challenges on the environmental front, ranging from global warming to forest degradation.</p>
<p>One corrosive impact of our greed is the shrinking wildlife diversity and population. In 2000, IUCN counted a total of around <a href="https://portals.iucn.org/library/sites/library/files/documents/RL-2000-001.pdf" target="_blank">10,000 endangered species</a>. By 2017, this number has doubled to <a href="https://www.statista.com/statistics/269910/red-list-endangered-animals-2010-and-2000/" target="_blank">24,431 species</a>. In the face of such overwhelming statistics, it is imperative for us to take action and protect these species from extinction. In this project, we will aim to contribute by using data from both <a href="https://www.cites.org/eng/disc/what.php" target="_blank">CITES (Convention on Internation Trade in Endangered Species of Wild Fauna and Flora)</a> and <a href="http://www.iucnredlist.org/about/introduction" target="_blank">IUCN</a> <span class="hl">to identify the major players behind endangered wildlife trade</span>.</p>
<p>To skip the methodology and proceed straight to the results, please click <a href="#summary-of-results">here</a>.</p>
</section>
<section id="preliminaries" class="level2">
<h2>Preliminaries</h2>
<p>First load the necessary packages for this exercise.</p>
<pre class="r"><code># Load default settings for R Markdown -- see file for more details
source(&quot;shared/defaults.R&quot;)
# Load some helper functions
source(&quot;shared/helper.R&quot;)

options(stringsAsFactors = FALSE)
packages &lt;- c(&quot;dplyr&quot;,&quot;ggplot2&quot;,&quot;tidyr&quot;,&quot;pander&quot;,&quot;DiagrammeR&quot;)
load_or_install.packages(packages)

data_dir &lt;- &quot;data/&quot;
specs_dir &lt;- &quot;specs/&quot;

si &lt;- sessionInfo()
base_pkg_str &lt;- paste0(&quot;Base Packages: &quot;,paste(si[[&quot;basePkgs&quot;]], collapse=&quot;, &quot;))
attached_pkg_str &lt;- paste0(&quot;Attached Packages: &quot;,paste(names(si[[&quot;otherPkgs&quot;]]), collapse=&quot;, &quot;))
cat(paste0(base_pkg_str,&quot;\n&quot;,attached_pkg_str))</code></pre>
<pre><code>## Base Packages: stats, graphics, grDevices, utils, datasets, methods, base
## Attached Packages: DiagrammeR, tidyr, pander, ggplot2, dplyr, knitr</code></pre>
</section>
<section id="about-the-data" class="level2">
<h2>About the Data</h2>
<p>We will be using wildlife trade data from <a href="https://www.cites.org/" target="_blank">CITES</a> for the period of 2001 to 2015, with the following caveats:</p>
<ul>
<li>2016 and 2017 were excluded due to data lag in the year of analysis (2018). (See <a href="https://trade.cites.org/cites_trade_guidelines/en-CITES_Trade_Database_Guide.pdf" target="_blank">Section 1.2.2 of the guide</a> for more details).</li>
<li>Analysis will be restricted to trades whose sources originated from the wild.</li>
</ul>
<p>Listed below is an overview of the CITES data:</p>
<pre class="r"><code># Load Data
dataset &lt;- read.csv(paste0(data_dir,&quot;cites_2001.csv&quot;))
for (yy in 2002:2015) {
  dataset &lt;- rbind(dataset, read.csv(paste0(data_dir,&quot;cites_&quot;,yy,&quot;.csv&quot;)))
}

# Add Legends
dataset &lt;- dataset %&gt;% 
  left_join(read.csv(paste0(specs_dir,&quot;cites_purpose.csv&quot;)), by=&quot;Purpose&quot;) %&gt;%
  select(-Purpose) %&gt;%
  rename(Purpose = Explanation) %&gt;%
  left_join(read.csv(paste0(specs_dir,&quot;cites_source.csv&quot;)), by=&quot;Source&quot;) %&gt;%
  select(-Source) %&gt;%
  rename(Source = Explanation)

cols_summary &lt;- data_overview(dataset)
  
pander(cols_summary, caption=&#39;Wildlife Trade Data - For more info, please visit &lt;a href=&quot;https://trade.cites.org/&quot; target=&quot;_blank&quot;&gt;CITES Trade Database&lt;/a&gt;&#39;)</code></pre>
<div class="table-responsive"><table>
<caption>Wildlife Trade Data - For more info, please visit <a href="https://trade.cites.org/" target="_blank">CITES Trade Database</a></caption>
<colgroup>
<col style="width: 34%" />
<col style="width: 14%" />
<col style="width: 38%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">ColumnNames</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Examples</th>
<th style="text-align: left;">PctFilled</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Year</td>
<td style="text-align: left;">INTEGER</td>
<td style="text-align: left;">2001 // 2002 // 2003 // 2004 // 2005</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="even">
<td style="text-align: left;">App.</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">I // II // III // N</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Taxon</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">Aquila heliaca // Haliaeetus albicilla // Haliaeetus leucocephalus // Harpia harpyja // Acipenser sturio</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Class</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">Aves // Actinopteri // Mammalia // Reptilia // Amphibia</td>
<td style="text-align: left;">93%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Order</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">Falconiformes // Acipenseriformes // Anseriformes // Pinales // Primates</td>
<td style="text-align: left;">99%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Family</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">Accipitridae // Acipenseridae // Anatidae // Araucariaceae // Atelidae</td>
<td style="text-align: left;">98%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Genus</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">Aquila // Haliaeetus // Harpia // Acipenser // Branta</td>
<td style="text-align: left;">97%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Importer</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">US // AT // GL // CA // CL</td>
<td style="text-align: left;">99%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Exporter</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">KZ // DK // US // CA // PT</td>
<td style="text-align: left;">98%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Origin</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">GL // US // BR // EC // PA</td>
<td style="text-align: left;">44%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Importer.reported.quantity</td>
<td style="text-align: left;">NUMERIC</td>
<td style="text-align: left;">100 // 46 // 1 // 33 // 188</td>
<td style="text-align: left;">50%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Exporter.reported.quantity</td>
<td style="text-align: left;">NUMERIC</td>
<td style="text-align: left;">57 // 1 // 12 // 89 // 6</td>
<td style="text-align: left;">72%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Term</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">specimens // live // bodies // feathers // claws</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Unit</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">ml // kg // g // sets // flasks</td>
<td style="text-align: left;">11%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Purpose</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">Scientific // Personal // Zoo // Law Enforcement // Hunting</td>
<td style="text-align: left;">96%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Source</td>
<td style="text-align: left;">CHARACTER</td>
<td style="text-align: left;">Wild // Unknown</td>
<td style="text-align: left;">97%</td>
</tr>
</tbody>
</table></div>
<p>From the <a href="https://trade.cites.org/cites_trade_guidelines/en-CITES_Trade_Database_Guide.pdf" target="_blank">guide</a> and the above summary, we know that:</p>
<ol type="1">
<li>Each row corresponds to the <span class="hl">total trade</span> between two countries for a particular species at a particular unit. This is contrary to popular belief that each row corresponds to one shipment. (See Section 3.1 for more details)</li>
<li>Not all animals in the data are endangered. For example, the <a href="https://en.wikipedia.org/wiki/White-tailed_eagle" target="_blank">white-tailed eagle (Haliaeetus albicilla)</a> is specified as <span class="hl">Least Concern</span> on <a href="http://www.iucnredlist.org/details/22695137/0" target="_blank">IUCN Red List</a>.</li>
<li>Terms are <span class="hl">heterogenous</span>. For examples, some quantities correspond to bodies, while others correspond to feathers.</li>
<li>Units are also <span class="hl">varied</span>. Quantities can be quoted as distinct counts (i.e. blank Unit), or in terms of weight/volume/qualitative units.</li>
</ol>
<p>As can be seen, some pre-processing would be required before our analysis can proceed. In particular, (3) and (4) need to be standardized to allow comparison across species.</p>
</section>
<section id="pre-processing" class="level2">
<h2>Pre-Processing</h2>
<section id="rescoping-the-species" class="level3">
<h3>Rescoping the Species</h3>
<section id="animals-only" class="level4">
<h4>Animals Only</h4>
<p>In the data, taxonomies with blank <span class="hl">Class</span> correspond to plants. For the purposes of this analysis, we will exclude non-animals from the dataset.</p>
<pre class="r"><code>pre_clean &lt;- nrow(dataset)

dataset &lt;- dataset %&gt;%
  filter(Class != &quot;&quot;)

post_clean &lt;- nrow(dataset)
  
cat(sprintf(&quot;%i rows removed (%.0f%% of total)&quot;,pre_clean - post_clean,(pre_clean - post_clean)/pre_clean * 100))</code></pre>
<pre><code>## 31068 rows removed (7% of total)</code></pre>
</section>
<section id="endangered-only" class="level4">
<h4>Endangered Only</h4>
<p>Endangered status of species are located in <a href="http://www.iucnredlist.org/" target="_blank">IUCN Red List database</a>. Due to licensing restrictions, the data could not be uploaded for public view. However, one is free to create an account and download the csv from <a href="http://www.iucnredlist.org/search/saved?id=90695" target="_blank">here</a>.</p>
<p>Using the IUCN data, we can subsequently filter non-endangered species out of the CITES dataset.</p>
<pre class="r"><code>pre_clean &lt;- nrow(dataset)

# Create an account with IUCN and download the csv from http://www.iucnredlist.org/search/saved?id=90695
# Move the csv into the data folder and rename it as iucn_list.csv

iucn_dataset &lt;- read.csv(paste0(data_dir,&quot;iucn_list.csv&quot;), fileEncoding=&quot;latin1&quot;)

iucn_dataset &lt;- iucn_dataset %&gt;% 
  select(Order,
         Family,
         Genus,
         Species,
         CommonName = Common.names..Eng.,
         IUCNStatus = Red.List.status)
iucn_dataset$IUCNStatus &lt;- factor(iucn_dataset$IUCNStatus, 
                                  levels=c(&quot;EW&quot;,&quot;EX&quot;,&quot;VU&quot;,&quot;EN&quot;,&quot;CR&quot;),
                                  ordered = TRUE)

# Different trades might have different level of granularities
# Some taxonomies only exist until Order, some until Family, and
# some until Genus. For such circumstances, we will assume the 
# worst case scenario, i.e. choose the most endangered status
# among species in the same family
species_iucn_list &lt;- iucn_dataset %&gt;%
  mutate(Taxon = paste(Genus, Species)) %&gt;%
  select(Taxon, CommonName, IUCNStatus)
group_iucn &lt;- function (granular) {
  tmp_iucn_list &lt;- iucn_dataset
  tmp_iucn_list[&quot;Taxon&quot;] &lt;- lapply(tmp_iucn_list[granular],
                                   function (s) { paste0(toupper(substr(s,1,1)),tolower(substr(s,2,nchar(s))), &quot; spp.&quot;)})
  tmp_iucn_list %&gt;%
    group_by(Taxon) %&gt;%
    summarise(CommonName = &quot;&quot;,
              IUCNStatus = max(IUCNStatus))
}
genus_iucn_list &lt;- group_iucn(&quot;Genus&quot;)
family_iucn_list &lt;- group_iucn(&quot;Family&quot;)
order_iucn_list &lt;- group_iucn(&quot;Order&quot;)
iucn_list &lt;- rbind(species_iucn_list, 
                   genus_iucn_list, 
                   family_iucn_list, 
                   order_iucn_list)

dataset &lt;- dataset %&gt;%
  inner_join(iucn_list, by=&quot;Taxon&quot;)

post_clean &lt;- nrow(dataset)

cat(sprintf(&quot;%i rows removed (%.0f%% of total)&quot;,pre_clean - post_clean,(pre_clean - post_clean)/pre_clean * 100))</code></pre>
<pre><code>## 318189 rows removed (75% of total)</code></pre>
</section>
</section>
<section id="standardizing-the-terms" class="level3">
<h3>Standardizing the Terms</h3>
<p>After restricting the dataset to only endangered species, we need to standardize all the terms into universal <span class="hl">trading units</span>. Ideally, 1 trading unit should represent 1 animal.</p>
<p>Thse are the terms left to be standardized:</p>
<pre class="r"><code># Take the majority between input and output
dataset &lt;- dataset %&gt;%
  mutate(Qty = ifelse(is.na(Importer.reported.quantity),Exporter.reported.quantity,
                      ifelse(is.na(Exporter.reported.quantity),Importer.reported.quantity,
                             ifelse(Exporter.reported.quantity &gt; Importer.reported.quantity,
                                    Exporter.reported.quantity,
                                    Importer.reported.quantity))))

output_str &lt;- &quot;List of Terms:\n&quot; %&gt;%
               paste0(paste0(unique(dataset$Term), collapse=&quot;, &quot;),&quot;\n\n&quot;) %&gt;%
               paste0(&quot;List of Units:\n&quot;) %&gt;%
               paste0(paste0(unique((dataset %&gt;% 
                       mutate(Unit = ifelse(Unit == &quot;&quot;,&quot;count&quot;,Unit)))$Unit), 
                       collapse=&quot;, &quot;))

cat(output_str)</code></pre>
<pre><code>## List of Terms:
## specimens, derivatives, unspecified, bones, skin pieces, skins, horns, skulls, trophies, feathers, live, skeletons, hair, eggs (live), bodies, carapaces, scales, carvings, shoes, meat, leather products (small), eggs, leather products (large), claws, teeth, tusks, ivory carvings, ivory pieces, hair products, feet, ears, sets of piano keys, tails, bone pieces, garments, bone carvings, plates, extract, wax, oil, horn carvings, shells, gall, swim bladders, raw corals, leather items, genitalia, musk, powder, gall bladders, coral sand, horn pieces, venom, ivory scraps, fins, baleen, caviar, calipee, skin scraps, fingerlings, medicine, sides, jewellery - ivory , cloth, cosmetics, trunk, jewellery, rug, piano keys, fur products (large), dried plants
## 
## List of Units:
## count, ml, g, kg, flasks, mg, sets, cm, pairs, bags, cans, ft2, cartons, m2, boxes, l, cm2, bottles, m, shipments, cm3, m3, sides, microgrammes</code></pre>
<section id="scientific-units" class="level4">
<h4>Scientific Units</h4>
<p>The first thing we notice from the above text is that not all of the scientific units are SI (examples include <span class="hl">cm, g and litres</span>). Let us therefore first standardize all units to SI:</p>
<pre class="r"><code>pre_clean &lt;- nrow(dataset %&gt;% group_by(Term, Unit) %&gt;% summarise())

# A dictionary for converting scientific units to SI
# First item correspond to the SI unit
# and second the conversion factor
units_to_si &lt;- list(
  &quot;cm&quot; = c(&quot;m&quot;, 0.01),
  &quot;g&quot; = c(&quot;kg&quot;,0.001),
  &quot;pairs&quot; = c(&quot;&quot;,2),
  &quot;mg&quot; = c(&quot;kg&quot;,1e-6),
  &quot;l&quot; = c(&quot;m3&quot;,0.001),
  &quot;ml&quot; = c(&quot;m3&quot;,1e-6),
  &quot;ft2&quot; = c(&quot;m2&quot;,0.092903),
  &quot;cm2&quot; = c(&quot;m2&quot;,0.0001),
  &quot;cm3&quot; = c(&quot;m3&quot;,1e-6),
  &quot;microgrammes&quot; = c(&quot;kg&quot;,1e-9)
)

for (i in which(dataset$Unit %in% names(units_to_si))) {
  qty &lt;- dataset[i,&quot;Qty&quot;]
  unit &lt;- dataset[i,&quot;Unit&quot;]
  dataset[i,&quot;Unit&quot;] &lt;- units_to_si[[unit]][1]
  dataset[i,&quot;Qty&quot;] &lt;- as.double(units_to_si[[unit]][2]) * qty
}

post_clean &lt;- nrow(dataset %&gt;% group_by(Term, Unit) %&gt;% summarise())

cat(sprintf(&quot;%i term-unit pairs removed (%.0f%% of total)&quot;,pre_clean - post_clean,(pre_clean - post_clean)/pre_clean * 100))</code></pre>
<pre><code>## 62 term-unit pairs removed (28% of total)</code></pre>
</section>
<section id="term-1-unit" class="level4">
<h4>1 Term, 1 Unit</h4>
<p>Another problem to rectify is that 1 term can be recorded in different units. Consider the term <span class="hl">bodies</span>, which were recorded in counts, kilograms and even metres:</p>
<pre class="r"><code>term_unit_counts &lt;- dataset %&gt;%
  group_by(Term,Unit) %&gt;%
  summarise(Records = n(),
            Quantity = sum(Qty))
  
output_tbl &lt;- term_unit_counts %&gt;%
              filter(Term == &quot;bodies&quot;)

pander(output_tbl)</code></pre>
<div class="table-responsive"><table style="width:50%;">
<colgroup>
<col style="width: 12%" />
<col style="width: 9%" />
<col style="width: 13%" />
<col style="width: 13%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Term</th>
<th style="text-align: left;">Unit</th>
<th style="text-align: center;">Records</th>
<th style="text-align: center;">Quantity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">bodies</td>
<td style="text-align: left;"></td>
<td style="text-align: center;">1604</td>
<td style="text-align: center;">5487551</td>
</tr>
<tr class="even">
<td style="text-align: left;">bodies</td>
<td style="text-align: left;">kg</td>
<td style="text-align: center;">360</td>
<td style="text-align: center;">334071</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bodies</td>
<td style="text-align: left;">m</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.1</td>
</tr>
</tbody>
</table></div>
<p>Ideally, we would be able to convert kilograms of bodies into actual count by identifying each species’ weight. However, such methods are time-intensive, and fall outside the scope of this analysis. Therefore, we need to propose a conversion rule that is more manageable and yet still relatively accurate.</p>
<p>In order to ensure that the unit for each term is standardized, we will first choose the target unit for each term. This can be done by identifying the unit whose records (i.e. rows) are highest for each term:</p>
<pre class="r"><code>target_unit &lt;- term_unit_counts %&gt;%
  ungroup() %&gt;%
  group_by(Term) %&gt;%
  mutate(r = rank(desc(Records), ties.method = &#39;first&#39;)) %&gt;%
  summarise(
    NumberOfUnits = n(),
    Unit = max(ifelse(r == 1, Unit, NA), na.rm=TRUE),
    Records = max(ifelse(r == 1,Records,NA), na.rm=TRUE)
  )

output_str &lt;- &quot;Terms [with their Target Unit]:\n&quot;
terms_w_target_unit &lt;- target_unit %&gt;%
                       mutate(outputString = paste0(Term, &quot; [&quot;, ifelse(Unit == &quot;&quot;,&quot;count&quot;,Unit), &quot;]&quot;))

output_str &lt;- output_str %&gt;%
              paste0(paste0(terms_w_target_unit$outputString,collapse=&quot;, &quot;))
  
cat(output_str)</code></pre>
<pre><code>## Terms [with their Target Unit]:
## baleen [count], bodies [count], bone carvings [count], bone pieces [count], bones [count], calipee [count], carapaces [count], carvings [count], caviar [kg], claws [count], cloth [count], coral sand [kg], cosmetics [kg], derivatives [count], dried plants [count], ears [count], eggs [kg], eggs (live) [count], extract [kg], feathers [count], feet [count], fingerlings [kg], fins [kg], fur products (large) [count], gall [count], gall bladders [count], garments [count], genitalia [count], hair [count], hair products [count], horn carvings [count], horn pieces [count], horns [count], ivory carvings [count], ivory pieces [count], ivory scraps [count], jewellery [count], jewellery - ivory  [count], leather items [count], leather products (large) [count], leather products (small) [count], live [count], meat [kg], medicine [kg], musk [kg], oil [count], piano keys [count], plates [count], powder [kg], raw corals [count], rug [count], scales [count], sets of piano keys [count], shells [count], shoes [count], sides [count], skeletons [count], skin pieces [count], skin scraps [count], skins [count], skulls [count], specimens [count], swim bladders [kg], tails [count], teeth [count], trophies [count], trunk [count], tusks [count], unspecified [count], venom [kg], wax [kg]</code></pre>
<p>The tricky part comes in when we attempt to convert a quantity from a non-target unit to the target unit. During this step, we will assume that, <span class="hl">for each species, the median quantity of each term-unit pair corresponds to the same number of live animals</span>. In other words, if the median quantity of elephant bodies is 2, and the median quantity of elephant bodies in kgs is 14,000 kg, then the 2 elephant bodies are equivalent to 14,000 kgs.</p>
<p>With this assumption, we can convert a quantity from a non-target unit to a target unit using the following equation:</p>
<p><span class="math display">\[ q_{t} = \frac{q_{nt}}{m_{nt}} \times m_{t} \]</span></p>
<p>where <br> <span class="math inline">\(q_{t}\)</span> corresponds to the quantity in target unit, <br> <span class="math inline">\(q_{nt}\)</span> corresponds to the quantity in non-target unit, <br> <span class="math inline">\(m_{nt}\)</span> corresponds to the median quantity of the non-target unit (per record), and <br> <span class="math inline">\(m_{t}\)</span> corresponds to the median quantity of the target unit (per record).</p>
<p>With the above formalization, the conversion challenge gets reduced to finding the median quantity for a particular species, term and unit triplet.</p>
<section id="the-roll-up-median-approach" class="level5">
<h5>The Roll-Up Median Approach</h5>
<p>One potential challenge is that we do not have many data points for each species, term and unit triplet. To illustrate, consider the African bush elephant (Loxodonta africana) trades that were recorded in non-target units:</p>
<pre class="r"><code>output_tbl &lt;- dataset %&gt;% 
              filter(Taxon == &quot;Loxodonta africana&quot;) %&gt;%
              left_join(target_unit, by=c(&quot;Term&quot;,&quot;Unit&quot;)) %&gt;%
              filter(is.na(NumberOfUnits)) %&gt;%
              group_by(Taxon, Term, Unit) %&gt;%
              summarise(Records = n())

pander(head(output_tbl,5))</code></pre>
<div class="table-responsive"><table style="width:71%;">
<colgroup>
<col style="width: 29%" />
<col style="width: 19%" />
<col style="width: 9%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Taxon</th>
<th style="text-align: left;">Term</th>
<th style="text-align: left;">Unit</th>
<th style="text-align: center;">Records</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Loxodonta africana</td>
<td style="text-align: left;">bodies</td>
<td style="text-align: left;">kg</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Loxodonta africana</td>
<td style="text-align: left;">bones</td>
<td style="text-align: left;">kg</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Loxodonta africana</td>
<td style="text-align: left;">carvings</td>
<td style="text-align: left;">kg</td>
<td style="text-align: center;">20</td>
</tr>
<tr class="even">
<td style="text-align: left;">Loxodonta africana</td>
<td style="text-align: left;">carvings</td>
<td style="text-align: left;">m3</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Loxodonta africana</td>
<td style="text-align: left;">derivatives</td>
<td style="text-align: left;">kg</td>
<td style="text-align: center;">4</td>
</tr>
</tbody>
</table></div>
<p>We see that there is only a <span class="hl">single</span> data point for Loxodonta africana trades whose term and unit are “bodies” and “kg”. Such minute sample size is not sufficient to calculate the median quantity. Therefore, to obtain larger sample sizes, a roll-up approach is required:</p>
<pre class="r"><code># For documentation, please visit http://rich-iannone.github.io/DiagrammeR/graphviz_and_mermaid.html
grViz(paste0(&quot;
  digraph RollUp {

    # Default Specs
    graph [compound = true, nodesep = .5, ranksep = .25]
    node [fontname = &#39;&quot;,def_font,&quot;&#39;, fontsize = 14, fontcolor = &#39;&quot;,bg_color,&quot;&#39;, penwidth=0, color=&#39;&quot;,ltxt_color,&quot;&#39;, style=filled]
    edge [fontname = &#39;&quot;,def_font,&quot;&#39;, fontcolor = &#39;&quot;,ltxt_color,&quot;&#39;, color=&#39;&quot;,ltxt_color,&quot;&#39;]
    
    # Input Specs
    Inp [fillcolor = &#39;&quot;,ltxt_color,&quot;&#39;, label = &#39;(Species s, Term t, Unit u)&#39;, shape = rectangle]

    # Conclude Specs
    node [shape = oval]
    Species_Y [label = &#39;Use the median quantity\nof Species s, Term t and Unit u.&#39;, fillcolor = &#39;&quot;,get_color(1),&quot;&#39;]
    Genus_Y [label = &#39;Use the median quantity\nof Genus g, Term t and Unit u.&#39;, fillcolor = &#39;&quot;,get_color(2),&quot;&#39;]
    Family_Y [label = &#39;Use the median quantity\nof Family f, Term t and Unit u.&#39;, fillcolor = &#39;&quot;,get_color(3),&quot;&#39;]
    Order_Y [label = &#39;Use the median quantity\nof Order o, Term t and Unit u.&#39;, fillcolor = &#39;&quot;,get_color(4),&quot;&#39;]
    Class_Y [label = &#39;Use the median quantity\nof Class c, Term t and Unit u.&#39;, fillcolor = &#39;&quot;,get_color(5),&quot;&#39;]
    Kingdom_Y [label = &#39;Use the median quantity\nof Term t and Unit u (across all).&#39;, fillcolor = &#39;&quot;,txt_color,&quot;&#39;]

    # Trigger Specs
    node [shape = diamond, fillcolor = &#39;&quot;,bg_color,&quot;&#39;, fontcolor = &#39;&quot;,txt_color,&quot;&#39;, penwidth = 1]
    Species_T [label = &#39;Does the Species s\nhave &gt;=10 records\nfor the term t and unit u?&#39;]
    { rank = same; Species_T, Species_Y }
    Genus_T [label = &#39;Does g (the Genus of s)\nhave &gt;=10 records\nfor the term t and unit u?&#39;]
    { rank = same; Genus_T, Genus_Y }
    Family_T [label = &#39;Does f (the Family of g)\nhave &gt;=10 records\nfor the term t and unit u?&#39;]
    { rank = same; Family_T, Family_Y }
    Order_T [label = &#39;Does o (the Order of f)\nhave &gt;=10 records\nfor the term t and unit u?&#39;]
    { rank = same; Order_T, Order_Y }
    Class_T [label = &#39;Does c (the Class of o)\nhave any record\nfor the term t and unit u?&#39;]
    { rank = same; Class_T, Class_Y }

    # Yes edges
    Inp -&gt; Species_T
    edge [arrowhead = &#39;box&#39;, label = &#39;Yes&#39;]
    Species_T -&gt; Species_Y
    Genus_T -&gt; Genus_Y
    Family_T -&gt; Family_Y
    Order_T -&gt; Order_Y
    Class_T -&gt; Class_Y
    
    # No edges
    edge [label = &#39;     No&#39;]
    Species_T -&gt; Genus_T
    Genus_T -&gt; Family_T
    Family_T -&gt; Order_T
    Order_T -&gt; Class_T
    Class_T -&gt; Kingdom_Y

  }
&quot;), height=700)</code></pre>
<div id="htmlwidget-b2b752a996db073a9092" style="width:672px;height:700px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-b2b752a996db073a9092">{"x":{"diagram":"\n  digraph RollUp {\n\n    # Default Specs\n    graph [compound = true, nodesep = .5, ranksep = .25]\n    node [fontname = \"Source Sans Pro\", fontsize = 14, fontcolor = \"#ffffff\", penwidth=0, color=\"#424242BF\", style=filled]\n    edge [fontname = \"Source Sans Pro\", fontcolor = \"#424242BF\", color=\"#424242BF\"]\n    \n    # Input Specs\n    Inp [fillcolor = \"#424242BF\", label = \"(Species s, Term t, Unit u)\", shape = rectangle]\n\n    # Conclude Specs\n    node [shape = oval]\n    Species_Y [label = \"Use the median quantity\nof Species s, Term t and Unit u.\", fillcolor = \"#335A87\"]\n    Genus_Y [label = \"Use the median quantity\nof Genus g, Term t and Unit u.\", fillcolor = \"#3C7759\"]\n    Family_Y [label = \"Use the median quantity\nof Family f, Term t and Unit u.\", fillcolor = \"#A43820\"]\n    Order_Y [label = \"Use the median quantity\nof Order o, Term t and Unit u.\", fillcolor = \"#5C3C7C\"]\n    Class_Y [label = \"Use the median quantity\nof Class c, Term t and Unit u.\", fillcolor = \"#377D95\"]\n    Kingdom_Y [label = \"Use the median quantity\nof Term t and Unit u (across all).\", fillcolor = \"#424242\"]\n\n    # Trigger Specs\n    node [shape = diamond, fillcolor = \"#ffffff\", fontcolor = \"#424242\", penwidth = 1]\n    Species_T [label = \"Does the Species s\nhave >=10 records\nfor the term t and unit u?\"]\n    { rank = same; Species_T, Species_Y }\n    Genus_T [label = \"Does g (the Genus of s)\nhave >=10 records\nfor the term t and unit u?\"]\n    { rank = same; Genus_T, Genus_Y }\n    Family_T [label = \"Does f (the Family of g)\nhave >=10 records\nfor the term t and unit u?\"]\n    { rank = same; Family_T, Family_Y }\n    Order_T [label = \"Does o (the Order of f)\nhave >=10 records\nfor the term t and unit u?\"]\n    { rank = same; Order_T, Order_Y }\n    Class_T [label = \"Does c (the Class of o)\nhave any record\nfor the term t and unit u?\"]\n    { rank = same; Class_T, Class_Y }\n\n    # Yes edges\n    Inp -> Species_T\n    edge [arrowhead = \"box\", label = \"Yes\"]\n    Species_T -> Species_Y\n    Genus_T -> Genus_Y\n    Family_T -> Family_Y\n    Order_T -> Order_Y\n    Class_T -> Class_Y\n    \n    # No edges\n    edge [label = \"     No\"]\n    Species_T -> Genus_T\n    Genus_T -> Family_T\n    Family_T -> Order_T\n    Order_T -> Class_T\n    Class_T -> Kingdom_Y\n\n  }\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>To sum up the flowchart above, for each species, we first attempt to count the number of records under the given term and unit. If the records are insufficient, we then “roll-up” and attempt to find the record count for the genus associated with the species. This process continues until we obtain a sufficient number of records (in this case 10) to calculate the median.</p>
<p>Using the following process, we are able to convert all the terms to their respective standardized units.</p>
<pre class="r"><code>pre_clean &lt;- nrow(dataset %&gt;% group_by(Term, Unit) %&gt;% summarise())

# Convert the term and units of the dataset to their desired targets
# @input data: the dataset
# @input target: the target term-unit pairs. If we are converting
# terms to standardized units, target should contain 2 columns: Term and Unit.
# If we are converting terms to 1 term, target should contain 1 column: Term.
convertViaMedian &lt;- function(data, target) {
  
  convert_term &lt;- length(colnames(target)) == 1
  # Add a Converted column to keep track which quantities have been converted and which has not
  if (!(&quot;Converted&quot; %in% colnames(data))) {
    data[&quot;Converted&quot;] &lt;- FALSE
  }
  
  # Initalize variables
  taxonomy &lt;- data %&gt;% 
    mutate(Kingdom = &quot;Animalia&quot;) %&gt;%
    group_by(Kingdom,Class,Order,Family,Genus,Taxon) %&gt;% 
    summarise() %&gt;% ungroup()
  
  if (convert_term) {
    must_have_units &lt;- data %&gt;% 
                      group_by(Taxon) %&gt;%
                      summarise()
    must_have_units[&quot;Term&quot;] &lt;- target[1,&quot;Term&quot;]
    must_have_units[&quot;Unit&quot;] &lt;- &quot;&quot;
  } else {
    must_have_units &lt;- data %&gt;% 
      group_by(Taxon, Term) %&gt;% 
      summarise() %&gt;% 
      left_join(target, by=&quot;Term&quot;)
  }
  
  
  # Function to find the medians for each granularity groupings (Species, Genus, etc)
  get_medians &lt;- function (data, granularity) {
    output &lt;- data
    if (granularity == &quot;Kingdom&quot;) {
      output[&quot;Grouping&quot;] &lt;- &quot;Animalia&quot;
    } else {
      output[&quot;Grouping&quot;] &lt;- output[granularity]
    }
    output &lt;- output %&gt;% 
      filter(Grouping != &#39;&#39;) %&gt;%
      group_by(Grouping, Term, Unit) %&gt;%
      summarise(
        Records = n(),
        Median = median(Qty)
      )
    return(output)
  }
  
  # Create the median dictionaries which contains a Taxon, Term and Unit pair, along with their
  # median trade quantities
  median_dict &lt;- get_medians(data, &quot;Taxon&quot;) %&gt;%
    full_join(must_have_units, by=c(&quot;Grouping&quot;=&quot;Taxon&quot;,&quot;Term&quot;=&quot;Term&quot;,&quot;Unit&quot;=&quot;Unit&quot;)) %&gt;%
    mutate(Records = ifelse(is.na(Records),0,Records))
  for (granular in c(&quot;Genus&quot;,&quot;Family&quot;,&quot;Order&quot;,&quot;Class&quot;,&quot;Kingdom&quot;)) {
    
    # Get the medians for a particular granularity
    reference &lt;- get_medians(data, granular) %&gt;%
      rename(ProposedRecord = Records,
             ProposedMedian = Median)
    
    # Link the reference to the current dictionary
    linkname &lt;- taxonomy %&gt;%
      select_at(vars(&quot;Taxon&quot;,granular)) %&gt;%
      rename_at(vars(granular), function(x) {&quot;Link&quot;})
    
    # Update all rows for which Records &lt; 10
    median_dict &lt;- median_dict %&gt;%
      left_join(linkname, by=c(&quot;Grouping&quot;=&quot;Taxon&quot;)) %&gt;%
      left_join(reference, by=c(&quot;Link&quot;=&quot;Grouping&quot;, &quot;Term&quot;=&quot;Term&quot;,&quot;Unit&quot;=&quot;Unit&quot;)) %&gt;%
      mutate(
        Median = ifelse((granular == &#39;Kingdom&#39; &amp; is.na(Median)) | 
                          (granular != &#39;Kingdom&#39; &amp; Records &lt; 10 &amp; !is.na(ProposedRecord)),
                        ProposedMedian, Median),
        Records = ifelse((granular == &#39;Kingdom&#39; &amp; Records == 0) |
                           (granular != &#39;Kingdom&#39; &amp; Records &lt; 10 &amp; !is.na(ProposedRecord)),
                         ProposedRecord, Records)
        
      ) %&gt;%
      select(-Link, -ProposedRecord, -ProposedMedian)
  }
  
  # Convert the term-unit from their original to the target using the median roll-up approach
  if (convert_term) {
    data[&quot;TargetTerm&quot;] &lt;- target[1,&quot;Term&quot;]
    data[&quot;TargetUnit&quot;] &lt;- &quot;&quot;
  } else {
    data &lt;- data %&gt;%
      left_join(target %&gt;% select(Term, TargetUnit = Unit), by=&quot;Term&quot;) %&gt;%   
      mutate(TargetTerm = Term)
  }
  
  data &lt;- data %&gt;%
    left_join(median_dict %&gt;% select(Grouping, Term, Unit, NonTargetMedian = Median),
              by = c(&quot;Taxon&quot;=&quot;Grouping&quot;,
                     &quot;Term&quot;=&quot;Term&quot;,
                     &quot;Unit&quot;=&quot;Unit&quot;)) %&gt;%
    left_join(median_dict %&gt;% select(Grouping, Term, Unit, TargetMedian = Median),
              by = c(&quot;Taxon&quot;=&quot;Grouping&quot;,
                     &quot;TargetTerm&quot;=&quot;Term&quot;,
                     &quot;TargetUnit&quot;=&quot;Unit&quot;)) %&gt;%
    mutate(
      Term = TargetTerm,
      Unit = TargetUnit,
      Qty = Qty / NonTargetMedian * TargetMedian,
      Converted = NonTargetMedian != TargetMedian | Converted
    ) %&gt;%
    select(-TargetTerm, -TargetUnit, -NonTargetMedian, -TargetMedian)
  
  return(data)
}

dataset &lt;- convertViaMedian(dataset, target_unit %&gt;% select(Term, Unit))

post_clean &lt;- nrow(dataset %&gt;% group_by(Term, Unit) %&gt;% summarise())

cat(sprintf(&quot;%i term-unit pairs removed (%.0f%% of total)&quot;,pre_clean - post_clean,(pre_clean - post_clean)/pre_clean * 100))</code></pre>
<pre><code>## 90 term-unit pairs removed (56% of total)</code></pre>
</section>
</section>
<section id="well-defined-terms" class="level4">
<h4>Well-Defined Terms</h4>
<p>Having standardized the units, we will now attempt to <span class="hl">convert each term to the equivalent number of live animals</span>. Listed below are each of the terms, along with their number of records:</p>
<pre class="r"><code>output_str &lt;- &quot;Terms [with their Records]:\n&quot;
terms_w_records &lt;- dataset %&gt;%
                   group_by(Term, Unit) %&gt;%
                   summarise(Records = n()) %&gt;%
                   mutate(outputString = paste0(Term, ifelse(Unit == &quot;&quot;,&quot;&quot;,paste0(&quot;/&quot;,Unit)),&quot; [&quot;, Records, &quot;]&quot;)) %&gt;%
                   arrange(desc(Records))

output_str &lt;- output_str %&gt;%
              paste0(paste0(terms_w_records$outputString,collapse=&quot;, &quot;))
  
cat(output_str)</code></pre>
<pre><code>## Terms [with their Records]:
## live [40062], trophies [9633], raw corals [9445], specimens [7971], eggs/kg [4858], leather products (small) [4365], skins [4047], tusks [3105], skulls [2758], carvings [2653], teeth [2077], bodies [1965], ivory carvings [1820], skin pieces [1575], feet [1275], derivatives [1002], leather products (large) [974], bones [837], tails [805], ears [680], feathers [562], hair [535], caviar/kg [478], garments [462], claws [372], meat/kg [360], shells [354], shoes [311], ivory pieces [309], carapaces [253], musk/kg [177], extract/kg [172], unspecified [139], horns [128], skeletons [109], bone carvings [104], hair products [99], medicine/kg [90], bone pieces [88], fins/kg [68], plates [54], baleen [50], genitalia [47], wax/kg [40], horn carvings [34], eggs (live) [28], scales [27], powder/kg [17], fingerlings/kg [13], horn pieces [12], gall [11], sides [9], leather items [8], oil [7], swim bladders/kg [7], rug [6], cosmetics/kg [5], trunk [5], coral sand/kg [4], jewellery [4], ivory scraps [3], jewellery - ivory  [3], cloth [2], gall bladders [2], calipee [1], dried plants [1], fur products (large) [1], piano keys [1], sets of piano keys [1], skin scraps [1], venom/kg [1]</code></pre>
<p>Through observation, we notice that theterms can be differentiated into: well-defined or ambiguous. Well-defined terms are those that have clear associations with the number of animals. A good example of this would be tusk, since 2 of them is always the equivalent of 1 animal.</p>
<p>Listed below are the terms which we will describe as well-defined:</p>
<pre class="r"><code>well_defined_terms &lt;- read.csv(paste0(specs_dir, &quot;well_defined_terms.csv&quot;))

output_str &lt;- &quot;Well-Defined Terms [with Number Per Live Animal]:\n&quot;
wdt &lt;- well_defined_terms %&gt;%
       mutate(outputString = paste0(Term,&quot; [&quot;, perAnimal, &quot;]&quot;))
output_str &lt;- output_str %&gt;%
              paste0(paste0(wdt$outputString,collapse=&quot;, &quot;))
  
cat(output_str)</code></pre>
<pre><code>## Well-Defined Terms [with Number Per Live Animal]:
## live [1], trophies [1], raw corals [1], specimens [1], tusks [2], skulls [1], bodies [1], tails [1], ears [2], genitalia [1], horns [1], trunk [1]</code></pre>
<p>Well-defined terms account for 71% of the total number of records. To convert a well-defined term, we simply need to divide the quantity by the number of terms per animal:</p>
<pre class="r"><code>pre_clean &lt;- nrow(dataset %&gt;% group_by(Term, Unit) %&gt;% summarise())

dataset &lt;- dataset %&gt;%
  left_join(well_defined_terms, by=&quot;Term&quot;) %&gt;%
  mutate(isWellDefined = !is.na(perAnimal),
         Term = ifelse(isWellDefined, &quot;animal&quot;,Term),
         Unit = ifelse(isWellDefined, &quot;&quot;, Unit),
         Qty = ifelse(isWellDefined, 1. / perAnimal, 1.) * Qty) %&gt;%
  select(-perAnimal, -isWellDefined)

post_clean &lt;- nrow(dataset %&gt;% group_by(Term, Unit) %&gt;% summarise())

cat(sprintf(&quot;%i term-unit pairs removed (%.0f%% of total)&quot;,pre_clean - post_clean,(pre_clean - post_clean)/pre_clean * 100))</code></pre>
<pre><code>## 11 term-unit pairs removed (15% of total)</code></pre>
</section>
<section id="ambiguous-terms" class="level4">
<h4>Ambiguous Terms</h4>
<p>The final piece of the jigsaw is to convert ambiguous terms. These terms, by nature of their names, are somewhat vague, and there exists no clear association between them and the number of animals. For example, how many ivory pieces make up an elephant? Depending on the size of the pieces, these numbers would differ record by record.</p>
<p>To simplify the conversion process, we will revisit our previous assumption when standardizing units of a term. Assuming that <span class="hl">across each species, the median quantity of each term corresponds to the same number of live animals</span>, we can subsequently convert ambiguous terms using the following equation:</p>
<p><span class="math display">\[ q_{animal} = \frac{q_{at}}{m_{at}} \times m_{animal} \]</span></p>
<p>where <br> <span class="math inline">\(q_{animal}\)</span> corresponds to the quantity of animals, <br> <span class="math inline">\(q_{at}\)</span> corresponds to the quantity of ambiguous terms, <br> <span class="math inline">\(m_{at}\)</span> corresponds to the median quantity of the ambiguous terms (per record), and <br> <span class="math inline">\(m_{animal}\)</span> corresponds to the median quantity of animals (per record).</p>
<p>Like before, the medians can be obtained through the <a href="#the-roll-up-median-approach">roll-up approach</a>. With this final step, we have finally standardized the huge list of term-unit pairs into a single animal unit:</p>
<pre class="r"><code>pre_clean &lt;- nrow(dataset %&gt;% group_by(Term, Unit) %&gt;% summarise())

target &lt;- data_frame(Term = &quot;animal&quot;)
dataset &lt;- convertViaMedian(dataset, target)

post_clean &lt;- nrow(dataset %&gt;% group_by(Term, Unit) %&gt;% summarise())

output_str &lt;- sprintf(&quot;%i term-unit pairs removed (%.0f%% of total)&quot;,pre_clean - post_clean,(pre_clean - post_clean)/pre_clean * 100) %&gt;%
              paste0(&quot;\n&quot;,&quot;1 Unit Remaining: &quot;,paste0(unique(dataset$Term), collapse=&quot;,&quot;))

cat(output_str)</code></pre>
<pre><code>## 59 term-unit pairs removed (98% of total)
## 1 Unit Remaining: animal</code></pre>
</section>
</section>
</section>
<section id="exploration" class="level2">
<h2>Exploration</h2>
</section>
<section id="tracing-supply-and-demand" class="level2">
<h2>Tracing Supply and Demand</h2>
<section id="the-algorithm" class="level3">
<h3>The Algorithm</h3>
</section>
<section id="following-the-demand" class="level3">
<h3>Following the Demand</h3>
</section>
<section id="finding-the-supply" class="level3">
<h3>Finding the Supply</h3>
</section>
</section>
<section id="summary-of-results" class="level2">
<h2>Summary of Results</h2>
</section>
<section id="limitations" class="level2">
<h2>Limitations</h2>
<ul>
<li>Wild</li>
<li>Unidentified Species</li>
</ul>
</section>
<section id="references" class="level2">
<h2>References</h2>
</section>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
